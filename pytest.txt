[1m============================= test session starts ==============================[0m
platform darwin -- Python 3.13.2, pytest-8.4.1, pluggy-1.6.0
rootdir: /Users/jeff/code/yokeflow2
configfile: pytest.ini
testpaths: tests
plugins: anyio-4.9.0, mockito-0.0.4, langsmith-0.4.4, logfire-3.1.0, mock-3.14.0, asyncio-1.0.0, cov-7.0.0
asyncio: mode=Mode.AUTO, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 433 items / 6 deselected / 427 selected

tests/test_agent.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31mF[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31mF[0m[32m.[0m[31m                                   [  4%][0m
tests/test_api_endpoints.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31mF[0m[31mF[0m[32m.[0m[32m.[0m[31m                    [ 10%][0m
tests/test_api_rest.py [32m.[0m[31mF[0m[31mF[0m[33ms[0m[33ms[0m[31mF[0m[33ms[0m[33ms[0m[31mF[0m[33ms[0m[33ms[0m[33ms[0m[32m.[0m[32m.[0m[32m.[0m[31mF[0m[32m.[0m[33ms[0m[33ms[0m[31m                               [ 14%][0m
tests/test_checkpoint.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                             [ 18%][0m
tests/test_claude_client.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[32m.[0m[31mF[0m[31mF[0m[31mF[0m[31m                                 [ 21%][0m
tests/test_claude_sdk_client.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[32m.[0m[31m                            [ 24%][0m
tests/test_database_extended.py [31mF[0m[31mF[0m[31mF[0m[31mE[0m[31mE[0m[32m.[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31m                        [ 28%][0m
tests/test_database_operations.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                      [ 32%][0m
tests/test_database_retry.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m              [ 39%][0m
tests/test_epic_validator.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                               [ 42%][0m
tests/test_errors.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                [ 51%][0m
tests/test_integration.py [31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[32m.[0m[32m.[0m[31mF[0m[31mF[0m[31mF[0m[32m.[0m[32m.[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31m                              [ 55%][0m
tests/test_integration_basic.py [32m.[0m[32m.[0m[32m.[0m[31mF[0m[32m.[0m[31mF[0m[32m.[0m[32m.[0m[31mF[0m[32m.[0m[32m.[0m[31mF[0m[32m.[0m[31mF[0m[31mF[0m[31mF[0m[31mF[0m[31m                        [ 59%][0m
tests/test_integration_database.py [31mE[0m[31mE[0m[31mE[0m[31mE[0m[31mE[0m[31mE[0m[31mE[0m[31mE[0m[31m                              [ 61%][0m
tests/test_integration_workflows.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                          [ 63%][0m
tests/test_intervention.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                                          [ 64%][0m
tests/test_intervention_system.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                                 [ 66%][0m
tests/test_orchestrator.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31mF[0m[31mF[0m[31mF[0m[32m.[0m[32m.[0m[31mF[0m[31mF[0m[31mF[0m[32m.[0m[32m.[0m[31m                             [ 70%][0m
tests/test_quality_extended.py [33ms[0m[33ms[0m[33ms[0m[33ms[0m[33ms[0m[33ms[0m[33ms[0m[33ms[0m[33ms[0m[33ms[0m[31m                                [ 72%][0m
tests/test_quality_integration.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[31mF[0m[32m.[0m[32m.[0m[32m.[0m[31mF[0m[31mF[0m[31m                             [ 74%][0m
tests/test_sandbox_manager.py [32m.[0m[32m.[0m[32m.[0m[31mF[0m[31mF[0m[32m.[0m[32m.[0m[32m.[0m[31mF[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                          [ 78%][0m
tests/test_security.py [32m.[0m[32m.[0m[31m                                                [ 79%][0m
tests/test_session_manager.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                            [ 82%][0m
tests/test_structured_logging.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                     [ 87%][0m
tests/test_task_verifier.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                                  [ 89%][0m
tests/test_test_generator.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                             [ 93%][0m
tests/test_verification_simple.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                       [ 96%][0m
tests/test_websocket.py [32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[32m.[0m[31m                                    [100%][0m

==================================== ERRORS ====================================
[31m[1m_____ ERROR at setup of TestDatabaseQueryBuilder.test_parameterized_query ______[0m
[1m[31mtests/test_database_extended.py[0m:79: in db
    [0m[94mreturn[39;49;00m DatabaseManager(pool=pool)[90m[39;49;00m
           ^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'[0m
[31m[1m___ ERROR at setup of TestDatabaseQueryBuilder.test_sql_injection_prevention ___[0m
[1m[31mtests/test_database_extended.py[0m:79: in db
    [0m[94mreturn[39;49;00m DatabaseManager(pool=pool)[90m[39;49;00m
           ^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'[0m
[31m[1m______ ERROR at setup of TestDatabaseIntegration.test_database_connection ______[0m
file /Users/jeff/code/yokeflow2/tests/test_integration_database.py, line 21
      @pytest.mark.asyncio
      async def test_database_connection(self, test_db):
          """Test basic database connection."""
          async with test_db.acquire() as conn:
              result = await conn.fetchval("SELECT 1")
              assert result == 1
file /Users/jeff/code/yokeflow2/tests/conftest_integration.py, line 121
  @pytest.fixture
  async def test_db(test_db_pool):
      """Provide a test database connection pool for individual tests."""
      # Clear all data before each test
      async with test_db_pool.acquire() as conn:
          # Get all table names (excluding system tables)
          tables = await conn.fetch("""
              SELECT tablename FROM pg_tables
              WHERE schemaname = 'public'
              AND tablename NOT LIKE 'pg_%'
          """)

          # Truncate all tables
          for table in tables:
              await conn.execute(f'TRUNCATE TABLE {table["tablename"]} CASCADE')

      yield test_db_pool
[31mE       fixture 'test_db_pool' not found[0m
[31m>       available fixtures: _class_event_loop, _function_event_loop, _module_event_loop, _package_event_loop, _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, api_client, cache, capfd, capfdbinary, capfire, caplog, capsys, capsysbinary, capteesys, class_mocker, cov, db, db_manager, db_session, doctest_namespace, event_loop, event_loop_policy, expect, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, mock_claude_client, mock_docker_sandbox, mock_mcp_server, mock_websocket, mocker, module_mocker, monkeypatch, no_cover, package_mocker, patch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, reset_singletons, sample_project, sample_project_data, sample_spec_content, session_logger, session_mocker, spy2, temp_project_dir, test_config, test_db, test_epic, test_project, test_session, test_task, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unstub, unstub_, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, when, when2[0m
[31m>       use 'pytest --fixtures [testpath]' for help on them.[0m

/Users/jeff/code/yokeflow2/tests/conftest_integration.py:121
[31m[1m_______ ERROR at setup of TestDatabaseIntegration.test_project_creation ________[0m
file /Users/jeff/code/yokeflow2/tests/test_integration_database.py, line 28
      @pytest.mark.asyncio
      async def test_project_creation(self, test_db):
          """Test creating a project."""
          async with test_db.acquire() as conn:
              project_id = await conn.fetchval("""
                  INSERT INTO projects (name, app_spec_path, project_path, status, created_at)
                  VALUES ($1, $2, $3, $4, $5)
                  RETURNING id
              """, "Test Project", "/tmp/spec.txt", "/tmp/project", "in_progress", datetime.now(timezone.utc))

              assert project_id is not None

              # Verify project was created
              project = await conn.fetchrow(
                  "SELECT * FROM projects WHERE id = $1", project_id
              )
              assert project["name"] == "Test Project"
              assert project["status"] == "in_progress"
file /Users/jeff/code/yokeflow2/tests/conftest_integration.py, line 121
  @pytest.fixture
  async def test_db(test_db_pool):
      """Provide a test database connection pool for individual tests."""
      # Clear all data before each test
      async with test_db_pool.acquire() as conn:
          # Get all table names (excluding system tables)
          tables = await conn.fetch("""
              SELECT tablename FROM pg_tables
              WHERE schemaname = 'public'
              AND tablename NOT LIKE 'pg_%'
          """)

          # Truncate all tables
          for table in tables:
              await conn.execute(f'TRUNCATE TABLE {table["tablename"]} CASCADE')

      yield test_db_pool
[31mE       fixture 'test_db_pool' not found[0m
[31m>       available fixtures: _class_event_loop, _function_event_loop, _module_event_loop, _package_event_loop, _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, api_client, cache, capfd, capfdbinary, capfire, caplog, capsys, capsysbinary, capteesys, class_mocker, cov, db, db_manager, db_session, doctest_namespace, event_loop, event_loop_policy, expect, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, mock_claude_client, mock_docker_sandbox, mock_mcp_server, mock_websocket, mocker, module_mocker, monkeypatch, no_cover, package_mocker, patch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, reset_singletons, sample_project, sample_project_data, sample_spec_content, session_logger, session_mocker, spy2, temp_project_dir, test_config, test_db, test_epic, test_project, test_session, test_task, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unstub, unstub_, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, when, when2[0m
[31m>       use 'pytest --fixtures [testpath]' for help on them.[0m

/Users/jeff/code/yokeflow2/tests/conftest_integration.py:121
[31m[1m___ ERROR at setup of TestDatabaseIntegration.test_task_database_operations ____[0m
file /Users/jeff/code/yokeflow2/tests/test_integration_database.py, line 47
      @pytest.mark.asyncio
      async def test_task_database_operations(self, db_session, sample_project):
          """Test TaskDatabase operations."""
          # Test getting project
          project = await db_session.get_project(sample_project["project_id"])
          assert project["name"] == "test_project"

          # Test getting epics
          epics = await db_session.get_epics(sample_project["project_id"])
          assert len(epics) == 1
          assert epics[0]["name"] == "Test Epic"

          # Test getting tasks
          tasks = await db_session.get_tasks(sample_project["project_id"])
          assert len(tasks) == 1
          assert tasks[0]["name"] == "Test Task"
file /Users/jeff/code/yokeflow2/tests/conftest_integration.py, line 140
  @pytest.fixture
  async def db_session(test_db):
      """Provide a database session (TaskDatabase instance) for tests."""
      db = TaskDatabase(pool=test_db)
      yield db
file /Users/jeff/code/yokeflow2/tests/conftest_integration.py, line 121
  @pytest.fixture
  async def test_db(test_db_pool):
      """Provide a test database connection pool for individual tests."""
      # Clear all data before each test
      async with test_db_pool.acquire() as conn:
          # Get all table names (excluding system tables)
          tables = await conn.fetch("""
              SELECT tablename FROM pg_tables
              WHERE schemaname = 'public'
              AND tablename NOT LIKE 'pg_%'
          """)

          # Truncate all tables
          for table in tables:
              await conn.execute(f'TRUNCATE TABLE {table["tablename"]} CASCADE')

      yield test_db_pool
[31mE       fixture 'test_db_pool' not found[0m
[31m>       available fixtures: _class_event_loop, _function_event_loop, _module_event_loop, _package_event_loop, _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, api_client, cache, capfd, capfdbinary, capfire, caplog, capsys, capsysbinary, capteesys, class_mocker, cov, db, db_manager, db_session, doctest_namespace, event_loop, event_loop_policy, expect, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, mock_claude_client, mock_docker_sandbox, mock_mcp_server, mock_websocket, mocker, module_mocker, monkeypatch, no_cover, package_mocker, patch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, reset_singletons, sample_project, sample_project_data, sample_spec_content, session_logger, session_mocker, spy2, temp_project_dir, test_config, test_db, test_epic, test_project, test_session, test_task, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unstub, unstub_, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, when, when2[0m
[31m>       use 'pytest --fixtures [testpath]' for help on them.[0m

/Users/jeff/code/yokeflow2/tests/conftest_integration.py:121
[31m[1m______ ERROR at setup of TestDatabaseIntegration.test_update_task_status _______[0m
file /Users/jeff/code/yokeflow2/tests/test_integration_database.py, line 64
      @pytest.mark.asyncio
      async def test_update_task_status(self, test_db, sample_project):
          """Test updating task status."""
          async with test_db.acquire() as conn:
              # Update task status
              await conn.execute("""
                  UPDATE tasks
                  SET status = $1, completed_at = $2
                  WHERE id = $3
              """, "completed", datetime.now(timezone.utc), sample_project["task_id"])

              # Verify update
              task = await conn.fetchrow(
                  "SELECT * FROM tasks WHERE id = $1", sample_project["task_id"]
              )
              assert task["status"] == "completed"
              assert task["completed_at"] is not None
file /Users/jeff/code/yokeflow2/tests/conftest_integration.py, line 121
  @pytest.fixture
  async def test_db(test_db_pool):
      """Provide a test database connection pool for individual tests."""
      # Clear all data before each test
      async with test_db_pool.acquire() as conn:
          # Get all table names (excluding system tables)
          tables = await conn.fetch("""
              SELECT tablename FROM pg_tables
              WHERE schemaname = 'public'
              AND tablename NOT LIKE 'pg_%'
          """)

          # Truncate all tables
          for table in tables:
              await conn.execute(f'TRUNCATE TABLE {table["tablename"]} CASCADE')

      yield test_db_pool
[31mE       fixture 'test_db_pool' not found[0m
[31m>       available fixtures: _class_event_loop, _function_event_loop, _module_event_loop, _package_event_loop, _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, api_client, cache, capfd, capfdbinary, capfire, caplog, capsys, capsysbinary, capteesys, class_mocker, cov, db, db_manager, db_session, doctest_namespace, event_loop, event_loop_policy, expect, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, mock_claude_client, mock_docker_sandbox, mock_mcp_server, mock_websocket, mocker, module_mocker, monkeypatch, no_cover, package_mocker, patch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, reset_singletons, sample_project, sample_project_data, sample_spec_content, session_logger, session_mocker, spy2, temp_project_dir, test_config, test_db, test_epic, test_project, test_session, test_task, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unstub, unstub_, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, when, when2[0m
[31m>       use 'pytest --fixtures [testpath]' for help on them.[0m

/Users/jeff/code/yokeflow2/tests/conftest_integration.py:121
[31m[1m_______ ERROR at setup of TestDatabaseIntegration.test_database_manager ________[0m
file /Users/jeff/code/yokeflow2/tests/test_integration_database.py, line 82
      @pytest.mark.asyncio
      async def test_database_manager(self, db_manager):
          """Test DatabaseManager context manager."""
          async with db_manager as conn:
              # Test query
              result = await conn.fetchval("SELECT COUNT(*) FROM projects")
              assert result >= 0
file /Users/jeff/code/yokeflow2/tests/conftest_integration.py, line 147
  @pytest.fixture
  async def db_manager(test_db):
      """Provide a DatabaseManager instance for tests."""
      # Temporarily set the TEST_DATABASE_URL as DATABASE_URL
      original_url = os.environ.get("DATABASE_URL")
      os.environ["DATABASE_URL"] = TEST_DATABASE_URL

      manager = DatabaseManager()
      await manager.initialize()

      yield manager

      await manager.close()

      # Restore original DATABASE_URL
      if original_url:
          os.environ["DATABASE_URL"] = original_url
      elif "DATABASE_URL" in os.environ:
          del os.environ["DATABASE_URL"]
file /Users/jeff/code/yokeflow2/tests/conftest_integration.py, line 121
  @pytest.fixture
  async def test_db(test_db_pool):
      """Provide a test database connection pool for individual tests."""
      # Clear all data before each test
      async with test_db_pool.acquire() as conn:
          # Get all table names (excluding system tables)
          tables = await conn.fetch("""
              SELECT tablename FROM pg_tables
              WHERE schemaname = 'public'
              AND tablename NOT LIKE 'pg_%'
          """)

          # Truncate all tables
          for table in tables:
              await conn.execute(f'TRUNCATE TABLE {table["tablename"]} CASCADE')

      yield test_db_pool
[31mE       fixture 'test_db_pool' not found[0m
[31m>       available fixtures: _class_event_loop, _function_event_loop, _module_event_loop, _package_event_loop, _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, api_client, cache, capfd, capfdbinary, capfire, caplog, capsys, capsysbinary, capteesys, class_mocker, cov, db, db_manager, db_session, doctest_namespace, event_loop, event_loop_policy, expect, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, mock_claude_client, mock_docker_sandbox, mock_mcp_server, mock_websocket, mocker, module_mocker, monkeypatch, no_cover, package_mocker, patch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, reset_singletons, sample_project, sample_project_data, sample_spec_content, session_logger, session_mocker, spy2, temp_project_dir, test_config, test_db, test_epic, test_project, test_session, test_task, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unstub, unstub_, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, when, when2[0m
[31m>       use 'pytest --fixtures [testpath]' for help on them.[0m

/Users/jeff/code/yokeflow2/tests/conftest_integration.py:121
[31m[1m_____ ERROR at setup of TestDatabaseIntegration.test_transaction_rollback ______[0m
file /Users/jeff/code/yokeflow2/tests/test_integration_database.py, line 90
      @pytest.mark.asyncio
      async def test_transaction_rollback(self, test_db):
          """Test transaction rollback on error."""
          async with test_db.acquire() as conn:
              # Start transaction
              async with conn.transaction():
                  # Insert project
                  project_id = await conn.fetchval("""
                      INSERT INTO projects (name, app_spec_path, project_path, status, created_at)
                      VALUES ($1, $2, $3, $4, $5)
                      RETURNING id
                  """, "Rollback Test", "/tmp/spec.txt", "/tmp/project", "in_progress", datetime.now(timezone.utc))

                  # Verify insert
                  count = await conn.fetchval("SELECT COUNT(*) FROM projects WHERE id = $1", project_id)
                  assert count == 1

                  # Force rollback by raising exception
                  if True:  # Always rollback for test
                      raise Exception("Test rollback")

          # Verify rollback - project should not exist
          async with test_db.acquire() as conn:
              count = await conn.fetchval("SELECT COUNT(*) FROM projects WHERE name = $1", "Rollback Test")
              assert count == 0
file /Users/jeff/code/yokeflow2/tests/conftest_integration.py, line 121
  @pytest.fixture
  async def test_db(test_db_pool):
      """Provide a test database connection pool for individual tests."""
      # Clear all data before each test
      async with test_db_pool.acquire() as conn:
          # Get all table names (excluding system tables)
          tables = await conn.fetch("""
              SELECT tablename FROM pg_tables
              WHERE schemaname = 'public'
              AND tablename NOT LIKE 'pg_%'
          """)

          # Truncate all tables
          for table in tables:
              await conn.execute(f'TRUNCATE TABLE {table["tablename"]} CASCADE')

      yield test_db_pool
[31mE       fixture 'test_db_pool' not found[0m
[31m>       available fixtures: _class_event_loop, _function_event_loop, _module_event_loop, _package_event_loop, _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, api_client, cache, capfd, capfdbinary, capfire, caplog, capsys, capsysbinary, capteesys, class_mocker, cov, db, db_manager, db_session, doctest_namespace, event_loop, event_loop_policy, expect, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, mock_claude_client, mock_docker_sandbox, mock_mcp_server, mock_websocket, mocker, module_mocker, monkeypatch, no_cover, package_mocker, patch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, reset_singletons, sample_project, sample_project_data, sample_spec_content, session_logger, session_mocker, spy2, temp_project_dir, test_config, test_db, test_epic, test_project, test_session, test_task, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unstub, unstub_, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, when, when2[0m
[31m>       use 'pytest --fixtures [testpath]' for help on them.[0m

/Users/jeff/code/yokeflow2/tests/conftest_integration.py:121
[31m[1m_______ ERROR at setup of TestDatabaseIntegration.test_cascading_delete ________[0m
file /Users/jeff/code/yokeflow2/tests/test_integration_database.py, line 116
      @pytest.mark.asyncio
      async def test_cascading_delete(self, test_db, sample_project):
          """Test cascading delete of project."""
          async with test_db.acquire() as conn:
              # Delete project (should cascade to epics, tasks, tests)
              await conn.execute(
                  "DELETE FROM projects WHERE id = $1", sample_project["project_id"]
              )

              # Verify cascade
              epic_count = await conn.fetchval(
                  "SELECT COUNT(*) FROM epics WHERE id = $1", sample_project["epic_id"]
              )
              assert epic_count == 0

              task_count = await conn.fetchval(
                  "SELECT COUNT(*) FROM tasks WHERE id = $1", sample_project["task_id"]
              )
              assert task_count == 0

              test_count = await conn.fetchval(
                  "SELECT COUNT(*) FROM tests WHERE id = $1", sample_project["test_id"]
              )
              assert test_count == 0
file /Users/jeff/code/yokeflow2/tests/conftest_integration.py, line 121
  @pytest.fixture
  async def test_db(test_db_pool):
      """Provide a test database connection pool for individual tests."""
      # Clear all data before each test
      async with test_db_pool.acquire() as conn:
          # Get all table names (excluding system tables)
          tables = await conn.fetch("""
              SELECT tablename FROM pg_tables
              WHERE schemaname = 'public'
              AND tablename NOT LIKE 'pg_%'
          """)

          # Truncate all tables
          for table in tables:
              await conn.execute(f'TRUNCATE TABLE {table["tablename"]} CASCADE')

      yield test_db_pool
[31mE       fixture 'test_db_pool' not found[0m
[31m>       available fixtures: _class_event_loop, _function_event_loop, _module_event_loop, _package_event_loop, _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, api_client, cache, capfd, capfdbinary, capfire, caplog, capsys, capsysbinary, capteesys, class_mocker, cov, db, db_manager, db_session, doctest_namespace, event_loop, event_loop_policy, expect, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, mock_claude_client, mock_docker_sandbox, mock_mcp_server, mock_websocket, mocker, module_mocker, monkeypatch, no_cover, package_mocker, patch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, reset_singletons, sample_project, sample_project_data, sample_spec_content, session_logger, session_mocker, spy2, temp_project_dir, test_config, test_db, test_epic, test_project, test_session, test_task, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unstub, unstub_, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, when, when2[0m
[31m>       use 'pytest --fixtures [testpath]' for help on them.[0m

/Users/jeff/code/yokeflow2/tests/conftest_integration.py:121
[31m[1m____________ ERROR at setup of TestDatabaseViews.test_progress_view ____________[0m
file /Users/jeff/code/yokeflow2/tests/test_integration_database.py, line 146
      @pytest.mark.asyncio
      async def test_progress_view(self, test_db, sample_project):
          """Test v_progress view."""
          async with test_db.acquire() as conn:
              # Update some tasks to completed
              await conn.execute("""
                  UPDATE tasks SET status = 'completed'
                  WHERE id = $1
              """, sample_project["task_id"])

              # Check progress view
              progress = await conn.fetchrow("""
                  SELECT * FROM v_progress
                  WHERE project_id = $1
              """, sample_project["project_id"])

              assert progress is not None
              assert progress["total_tasks"] == 1
              assert progress["completed_tasks"] == 1
              assert progress["progress_percentage"] == 100.0
file /Users/jeff/code/yokeflow2/tests/conftest_integration.py, line 121
  @pytest.fixture
  async def test_db(test_db_pool):
      """Provide a test database connection pool for individual tests."""
      # Clear all data before each test
      async with test_db_pool.acquire() as conn:
          # Get all table names (excluding system tables)
          tables = await conn.fetch("""
              SELECT tablename FROM pg_tables
              WHERE schemaname = 'public'
              AND tablename NOT LIKE 'pg_%'
          """)

          # Truncate all tables
          for table in tables:
              await conn.execute(f'TRUNCATE TABLE {table["tablename"]} CASCADE')

      yield test_db_pool
[31mE       fixture 'test_db_pool' not found[0m
[31m>       available fixtures: _class_event_loop, _function_event_loop, _module_event_loop, _package_event_loop, _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, api_client, cache, capfd, capfdbinary, capfire, caplog, capsys, capsysbinary, capteesys, class_mocker, cov, db, db_manager, db_session, doctest_namespace, event_loop, event_loop_policy, expect, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, mock_claude_client, mock_docker_sandbox, mock_mcp_server, mock_websocket, mocker, module_mocker, monkeypatch, no_cover, package_mocker, patch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, reset_singletons, sample_project, sample_project_data, sample_spec_content, session_logger, session_mocker, spy2, temp_project_dir, test_config, test_db, test_epic, test_project, test_session, test_task, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unstub, unstub_, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory, when, when2[0m
[31m>       use 'pytest --fixtures [testpath]' for help on them.[0m

/Users/jeff/code/yokeflow2/tests/conftest_integration.py:121
=================================== FAILURES ===================================
[31m[1m_________ TestRunAgentSession.test_run_agent_session_with_credit_error _________[0m
[1m[31mtests/test_agent.py[0m:286: in test_run_agent_session_with_credit_error
    [0m[94mwith[39;49;00m pytest.raises([96mRuntimeError[39;49;00m) [94mas[39;49;00m excinfo:[90m[39;49;00m
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   Failed: DID NOT RAISE <class 'RuntimeError'>[0m
----------------------------- Captured stdout call -----------------------------

‚ùå FATAL ERROR: Credit balance is too low - API key is being used instead of OAuth token
   This usually means ANTHROPIC_API_KEY leaked from the generated project.
   Check generations/{project}/.env and remove ANTHROPIC_API_KEY if present.
Error during agent session: Credit balance is too low - API key is being used instead of OAuth token
----------------------------- Captured stderr call -----------------------------
2026-01-08 20:13:28.836 | INFO     | server.agent.agent:138 | Starting agent session [session_id=test-ses, project_id=test-pro, taskName=Task-10, project_dir=/private/var/folders/jh/pvr5pwkd0nvd31wnmxxld0g80000gn/T/pytest-of-jeff/pytest-182/test_run_agent_session_with_cr0/test_project, verbose=False, intervention_enabled=False]
2026-01-08 20:13:28.836 | ERROR    | server.agent.agent:518 | Agent session failed [session_id=test-ses, project_id=test-pro, taskName=Task-10, error_type=RuntimeError, message_count=0]
Traceback (most recent call last):
  File "/Users/jeff/code/yokeflow2/server/agent/agent.py", line 218, in run_agent_session
    raise RuntimeError(error_msg)
RuntimeError: Credit balance is too low - API key is being used instead of OAuth token
------------------------------ Captured log call -------------------------------
[32mINFO    [0m server.agent.agent:agent.py:138 Starting agent session
[1m[31mERROR   [0m server.agent.agent:agent.py:518 Agent session failed
Traceback (most recent call last):
  File "/Users/jeff/code/yokeflow2/server/agent/agent.py", line 218, in run_agent_session
    raise RuntimeError(error_msg)
RuntimeError: Credit balance is too low - API key is being used instead of OAuth token
[31m[1m________ TestRunAgentSession.test_run_agent_session_exception_handling _________[0m
[1m[31mtests/test_agent.py[0m:475: in test_run_agent_session_exception_handling
    [0m[94massert[39;49;00m [33m"[39;49;00m[33mUnexpected error[39;49;00m[33m"[39;49;00m [95min[39;49;00m [96mstr[39;49;00m(excinfo.value)[90m[39;49;00m
[1m[31mE   assert 'Unexpected error' in "cannot access local variable 'usage_data' where it is not associated with a value"[0m
[1m[31mE    +  where "cannot access local variable 'usage_data' where it is not associated with a value" = str(UnboundLocalError("cannot access local variable 'usage_data' where it is not associated with a value"))[0m
[1m[31mE    +    where UnboundLocalError("cannot access local variable 'usage_data' where it is not associated with a value") = <ExceptionInfo UnboundLocalError("cannot access local variable 'usage_data' where it is not associated with a value") tblen=2>.value[0m
----------------------------- Captured stdout call -----------------------------
Error during agent session: Unexpected error
----------------------------- Captured stderr call -----------------------------
2026-01-08 20:13:28.869 | INFO     | server.agent.agent:138 | Starting agent session [session_id=test-ses, project_id=test-pro, taskName=Task-25, project_dir=/private/var/folders/jh/pvr5pwkd0nvd31wnmxxld0g80000gn/T/pytest-of-jeff/pytest-182/test_run_agent_session_excepti0/test_project, verbose=False, intervention_enabled=False]
2026-01-08 20:13:28.869 | ERROR    | server.agent.agent:518 | Agent session failed [session_id=test-ses, project_id=test-pro, taskName=Task-25, error_type=Exception, message_count=0]
Traceback (most recent call last):
  File "/Users/jeff/code/yokeflow2/server/agent/agent.py", line 163, in run_agent_session
    await client.query(message)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py", line 2319, in _execute_mock_call
    raise effect
Exception: Unexpected error
------------------------------ Captured log call -------------------------------
[32mINFO    [0m server.agent.agent:agent.py:138 Starting agent session
[1m[31mERROR   [0m server.agent.agent:agent.py:518 Agent session failed
Traceback (most recent call last):
  File "/Users/jeff/code/yokeflow2/server/agent/agent.py", line 163, in run_agent_session
    await client.query(message)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py", line 2319, in _execute_mock_call
    raise effect
Exception: Unexpected error
[31m[1m_______________ TestContainerEndpoints.test_get_container_status _______________[0m
[1m[31mtests/test_api_endpoints.py[0m:544: in test_get_container_status
    [0m[94massert[39;49;00m response.status_code == [94m200[39;49;00m[90m[39;49;00m
[1m[31mE   assert 400 == 200[0m
[1m[31mE    +  where 400 = <Response [400 Bad Request]>.status_code[0m
----------------------------- Captured stderr call -----------------------------
2026-01-08 20:13:28.938 | INFO     | server.database.connection:127 | Creating new global database connection pool [taskName=anyio.from_thread.BlockingPortal._call_func]
2026-01-08 20:13:28.939 | INFO     | httpx:1025 | HTTP Request: GET http://testserver/api/projects/f91b621b-1cd1-44f5-ba02-a907ea96d2e4/container/status "HTTP/1.1 400 Bad Request" [taskName=None]
------------------------------ Captured log call -------------------------------
[32mINFO    [0m server.database.connection:connection.py:127 Creating new global database connection pool
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET http://testserver/api/projects/f91b621b-1cd1-44f5-ba02-a907ea96d2e4/container/status "HTTP/1.1 400 Bad Request"
[31m[1m_________________ TestContainerEndpoints.test_start_container __________________[0m
[1m[31mtests/test_api_endpoints.py[0m:562: in test_start_container
    [0m[94massert[39;49;00m response.status_code == [94m200[39;49;00m[90m[39;49;00m
[1m[31mE   assert 400 == 200[0m
[1m[31mE    +  where 400 = <Response [400 Bad Request]>.status_code[0m
----------------------------- Captured stderr call -----------------------------
2026-01-08 20:13:28.943 | INFO     | server.database.connection:127 | Creating new global database connection pool [taskName=anyio.from_thread.BlockingPortal._call_func]
2026-01-08 20:13:28.944 | INFO     | httpx:1025 | HTTP Request: POST http://testserver/api/projects/4f465382-b3a8-4a6c-a4bd-f81b506cfc4c/container/start "HTTP/1.1 400 Bad Request" [taskName=None]
------------------------------ Captured log call -------------------------------
[32mINFO    [0m server.database.connection:connection.py:127 Creating new global database connection pool
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: POST http://testserver/api/projects/4f465382-b3a8-4a6c-a4bd-f81b506cfc4c/container/start "HTTP/1.1 400 Bad Request"
[31m[1m________________ TestHealthEndpoints.test_detailed_health_check ________________[0m
[1m[31mtests/test_api_rest.py[0m:54: in test_detailed_health_check
    [0m[94mwith[39;49;00m patch([33m"[39;49;00m[33mserver.api.app.check_database_health[39;49;00m[33m"[39;49;00m) [94mas[39;49;00m mock_db_health:[90m[39;49;00m
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31m/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py[0m:1495: in __enter__
    [0moriginal, local = [96mself[39;49;00m.get_original()[90m[39;49;00m
                      ^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31m/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py[0m:1465: in get_original
    [0m[94mraise[39;49;00m [96mAttributeError[39;49;00m([90m[39;49;00m
[1m[31mE   AttributeError: <module 'server.api.app' from '/Users/jeff/code/yokeflow2/server/api/app.py'> does not have the attribute 'check_database_health'[0m
[31m[1m__________________ TestSessionEndpoints.test_get_session_logs __________________[0m
[1m[31mtests/test_api_rest.py[0m:75: in test_get_session_logs
    [0mmock_orchestrator.get_session_logs.return_value = [[90m[39;49;00m
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31m/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py[0m:688: in __getattr__
    [0m[94mraise[39;49;00m [96mAttributeError[39;49;00m([33m"[39;49;00m[33mMock object has no attribute [39;49;00m[33m%r[39;49;00m[33m"[39;49;00m % name)[90m[39;49;00m
[1m[31mE   AttributeError: Mock object has no attribute 'get_session_logs'. Did you mean: 'get_session_info'?[0m
[31m[1m______________________ TestTaskEndpoints.test_list_tasks _______________________[0m
[1m[31mtests/test_api_rest.py[0m:139: in test_list_tasks
    [0m[94massert[39;49;00m response.status_code == [94m200[39;49;00m[90m[39;49;00m
[1m[31mE   assert 500 == 200[0m
[1m[31mE    +  where 500 = <Response [500 Internal Server Error]>.status_code[0m
----------------------------- Captured stderr call -----------------------------
2026-01-08 20:13:28.994 | INFO     | server.database.connection:127 | Creating new global database connection pool [taskName=anyio.from_thread.BlockingPortal._call_func]
2026-01-08 20:13:28.994 | ERROR    | server.api.app:1058 | Failed to get tasks for project 348d53ef-c3aa-43ae-83a5-2cef0eb53c7e: DATABASE_URL environment variable not set. Please configure it in your .env file. Example: DATABASE_URL=postgresql://agent:password@localhost:5432/yokeflow [taskName=anyio.from_thread.BlockingPortal._call_func]
2026-01-08 20:13:28.995 | INFO     | httpx:1025 | HTTP Request: GET http://testserver/api/projects/348d53ef-c3aa-43ae-83a5-2cef0eb53c7e/tasks "HTTP/1.1 500 Internal Server Error" [taskName=None]
------------------------------ Captured log call -------------------------------
[32mINFO    [0m server.database.connection:connection.py:127 Creating new global database connection pool
[1m[31mERROR   [0m server.api.app:app.py:1058 Failed to get tasks for project 348d53ef-c3aa-43ae-83a5-2cef0eb53c7e: DATABASE_URL environment variable not set. Please configure it in your .env file. Example: DATABASE_URL=postgresql://agent:password@localhost:5432/yokeflow
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET http://testserver/api/projects/348d53ef-c3aa-43ae-83a5-2cef0eb53c7e/tasks "HTTP/1.1 500 Internal Server Error"
[31m[1m______________________ TestEpicEndpoints.test_list_epics _______________________[0m
[1m[31mtests/test_api_rest.py[0m:205: in test_list_epics
    [0m[94massert[39;49;00m response.status_code == [94m200[39;49;00m[90m[39;49;00m
[1m[31mE   assert 500 == 200[0m
[1m[31mE    +  where 500 = <Response [500 Internal Server Error]>.status_code[0m
----------------------------- Captured stderr call -----------------------------
2026-01-08 20:13:29.001 | INFO     | server.database.connection:127 | Creating new global database connection pool [taskName=anyio.from_thread.BlockingPortal._call_func]
2026-01-08 20:13:29.001 | ERROR    | server.api.app:1042 | Failed to get epics for project 4622bf3b-9bc6-4a6c-a04e-9ad028195bd1: DATABASE_URL environment variable not set. Please configure it in your .env file. Example: DATABASE_URL=postgresql://agent:password@localhost:5432/yokeflow [taskName=anyio.from_thread.BlockingPortal._call_func]
2026-01-08 20:13:29.001 | INFO     | httpx:1025 | HTTP Request: GET http://testserver/api/projects/4622bf3b-9bc6-4a6c-a04e-9ad028195bd1/epics "HTTP/1.1 500 Internal Server Error" [taskName=None]
------------------------------ Captured log call -------------------------------
[32mINFO    [0m server.database.connection:connection.py:127 Creating new global database connection pool
[1m[31mERROR   [0m server.api.app:app.py:1042 Failed to get epics for project 4622bf3b-9bc6-4a6c-a04e-9ad028195bd1: DATABASE_URL environment variable not set. Please configure it in your .env file. Example: DATABASE_URL=postgresql://agent:password@localhost:5432/yokeflow
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET http://testserver/api/projects/4622bf3b-9bc6-4a6c-a04e-9ad028195bd1/epics "HTTP/1.1 500 Internal Server Error"
[31m[1m________________ TestErrorHandling.test_database_error_handling ________________[0m
[1m[31mtests/test_api_rest.py[0m:316: in test_database_error_handling
    [0m[94massert[39;49;00m response.status_code == [94m500[39;49;00m[90m[39;49;00m
[1m[31mE   assert 400 == 500[0m
[1m[31mE    +  where 400 = <Response [400 Bad Request]>.status_code[0m
----------------------------- Captured stderr call -----------------------------
2026-01-08 20:13:29.011 | INFO     | server.database.connection:127 | Creating new global database connection pool [taskName=anyio.from_thread.BlockingPortal._call_func]
2026-01-08 20:13:29.011 | INFO     | httpx:1025 | HTTP Request: GET http://testserver/api/projects/c436d593-8e6e-4223-8c90-a34637b17892 "HTTP/1.1 400 Bad Request" [taskName=None]
------------------------------ Captured log call -------------------------------
[32mINFO    [0m server.database.connection:connection.py:127 Creating new global database connection pool
[32mINFO    [0m httpx:_client.py:1025 HTTP Request: GET http://testserver/api/projects/c436d593-8e6e-4223-8c90-a34637b17892 "HTTP/1.1 400 Bad Request"
[31m[1m__________________ TestClaudeClient.test_create_client_basic ___________________[0m
[1m[31mtests/test_claude_client.py[0m:128: in test_create_client_basic
    [0mclient = create_client([90m[39;49;00m
[1m[31mserver/client/claude.py[0m:119: in create_client
    [0m[94mraise[39;49;00m [96mFileNotFoundError[39;49;00m([90m[39;49;00m
[1m[31mE   FileNotFoundError: MCP task manager server not found at /Users/jeff/code/mcp-task-manager/dist/index.js. Run 'cd mcp-task-manager && npm install && npm run build' to build it.[0m
[31m[1m_______________ TestClaudeClient.test_create_client_with_docker ________________[0m
[1m[31mtests/test_claude_client.py[0m:151: in test_create_client_with_docker
    [0mclient = create_client([90m[39;49;00m
[1m[31mserver/client/claude.py[0m:119: in create_client
    [0m[94mraise[39;49;00m [96mFileNotFoundError[39;49;00m([90m[39;49;00m
[1m[31mE   FileNotFoundError: MCP task manager server not found at /Users/jeff/code/mcp-task-manager/dist/index.js. Run 'cd mcp-task-manager && npm install && npm run build' to build it.[0m
[31m[1m________ TestClaudeClient.test_create_client_without_docker_playwright _________[0m
[1m[31mtests/test_claude_client.py[0m:175: in test_create_client_without_docker_playwright
    [0mclient = create_client([90m[39;49;00m
[1m[31mserver/client/claude.py[0m:119: in create_client
    [0m[94mraise[39;49;00m [96mFileNotFoundError[39;49;00m([90m[39;49;00m
[1m[31mE   FileNotFoundError: MCP task manager server not found at /Users/jeff/code/mcp-task-manager/dist/index.js. Run 'cd mcp-task-manager && npm install && npm run build' to build it.[0m
[31m[1m_____________ TestClaudeClient.test_create_client_removes_api_key ______________[0m
[1m[31mtests/test_claude_client.py[0m:200: in test_create_client_removes_api_key
    [0mclient = create_client([90m[39;49;00m
[1m[31mserver/client/claude.py[0m:119: in create_client
    [0m[94mraise[39;49;00m [96mFileNotFoundError[39;49;00m([90m[39;49;00m
[1m[31mE   FileNotFoundError: MCP task manager server not found at /Users/jeff/code/mcp-task-manager/dist/index.js. Run 'cd mcp-task-manager && npm install && npm run build' to build it.[0m
[31m[1m_____________ TestClaudeClient.test_create_client_hooks_configured _____________[0m
[1m[31mtests/test_claude_client.py[0m:251: in test_create_client_hooks_configured
    [0mclient = create_client([90m[39;49;00m
[1m[31mserver/client/claude.py[0m:119: in create_client
    [0m[94mraise[39;49;00m [96mFileNotFoundError[39;49;00m([90m[39;49;00m
[1m[31mE   FileNotFoundError: MCP task manager server not found at /Users/jeff/code/mcp-task-manager/dist/index.js. Run 'cd mcp-task-manager && npm install && npm run build' to build it.[0m
[31m[1m____________ TestClaudeClient.test_create_client_oauth_token_in_env ____________[0m
[1m[31mtests/test_claude_client.py[0m:279: in test_create_client_oauth_token_in_env
    [0mclient = create_client([90m[39;49;00m
[1m[31mserver/client/claude.py[0m:119: in create_client
    [0m[94mraise[39;49;00m [96mFileNotFoundError[39;49;00m([90m[39;49;00m
[1m[31mE   FileNotFoundError: MCP task manager server not found at /Users/jeff/code/mcp-task-manager/dist/index.js. Run 'cd mcp-task-manager && npm install && npm run build' to build it.[0m
[31m[1m______________ TestClaudeClient.test_create_client_system_prompt _______________[0m
[1m[31mtests/test_claude_client.py[0m:300: in test_create_client_system_prompt
    [0mclient = create_client([90m[39;49;00m
[1m[31mserver/client/claude.py[0m:119: in create_client
    [0m[94mraise[39;49;00m [96mFileNotFoundError[39;49;00m([90m[39;49;00m
[1m[31mE   FileNotFoundError: MCP task manager server not found at /Users/jeff/code/mcp-task-manager/dist/index.js. Run 'cd mcp-task-manager && npm install && npm run build' to build it.[0m
[31m[1m__________________ TestClaudeClient.test_create_client_basic ___________________[0m
[1m[31m/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py[0m:956: in assert_called_once
    [0m[94mraise[39;49;00m [96mAssertionError[39;49;00m(msg)[90m[39;49;00m
[1m[31mE   AssertionError: Expected 'ClaudeSDKClient' to have been called once. Called 0 times.[0m

[33mDuring handling of the above exception, another exception occurred:[0m
[1m[31mtests/test_claude_sdk_client.py[0m:110: in test_create_client_basic
    [0mmock_sdk_client.assert_called_once()[90m[39;49;00m
[1m[31mE   AssertionError: Expected 'ClaudeSDKClient' to have been called once. Called 0 times.[0m
----------------------------- Captured stdout call -----------------------------
[DEBUG] MCP task-manager using generated UUID for project: project (ID: d628296e-a6bd-5712-8cd1-b32bbab5d645)
[DEBUG] Adding external Playwright MCP server (non-Docker mode or disabled)
----------------------------- Captured stderr call -----------------------------
2026-01-08 20:13:29.064 | ERROR    | server.utils.auth:72 | Error reading Claude credentials file: [Errno 2] No such file or directory: '/Users/jeff/.claude/.credentials.json' [taskName=None]
2026-01-08 20:13:29.064 | INFO     | server.utils.auth:97 | [AUTH] Using OAuth token from environment variable (credentials file not available) [taskName=None]
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m server.utils.auth:auth.py:72 Error reading Claude credentials file: [Errno 2] No such file or directory: '/Users/jeff/.claude/.credentials.json'
[32mINFO    [0m server.utils.auth:auth.py:97 [AUTH] Using OAuth token from environment variable (credentials file not available)
[31m[1m_______________ TestClaudeClient.test_create_client_with_docker ________________[0m
[1m[31m/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py[0m:956: in assert_called_once
    [0m[94mraise[39;49;00m [96mAssertionError[39;49;00m(msg)[90m[39;49;00m
[1m[31mE   AssertionError: Expected 'ClaudeSDKClient' to have been called once. Called 0 times.[0m

[33mDuring handling of the above exception, another exception occurred:[0m
[1m[31mtests/test_claude_sdk_client.py[0m:135: in test_create_client_with_docker
    [0mmock_sdk_client.assert_called_once()[90m[39;49;00m
[1m[31mE   AssertionError: Expected 'ClaudeSDKClient' to have been called once. Called 0 times.[0m
----------------------------- Captured stdout call -----------------------------
[DEBUG] MCP task-manager using generated UUID for project: project (ID: d628296e-a6bd-5712-8cd1-b32bbab5d645)
[DEBUG] MCP task-manager configured for Docker sandbox: test-container
[DEBUG] Skipping external Playwright MCP - using Docker Playwright in container: test-container
----------------------------- Captured stderr call -----------------------------
2026-01-08 20:13:29.080 | ERROR    | server.utils.auth:72 | Error reading Claude credentials file: [Errno 2] No such file or directory: '/Users/jeff/.claude/.credentials.json' [taskName=None]
2026-01-08 20:13:29.080 | INFO     | server.utils.auth:97 | [AUTH] Using OAuth token from environment variable (credentials file not available) [taskName=None]
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m server.utils.auth:auth.py:72 Error reading Claude credentials file: [Errno 2] No such file or directory: '/Users/jeff/.claude/.credentials.json'
[32mINFO    [0m server.utils.auth:auth.py:97 [AUTH] Using OAuth token from environment variable (credentials file not available)
[31m[1m________________ TestClaudeClient.test_create_client_with_hooks ________________[0m
[1m[31mtests/test_claude_sdk_client.py[0m:157: in test_create_client_with_hooks
    [0moptions = call_args[[94m1[39;49;00m][[33m"[39;49;00m[33moptions[39;49;00m[33m"[39;49;00m][90m[39;49;00m
              ^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: 'NoneType' object is not subscriptable[0m
----------------------------- Captured stdout call -----------------------------
[DEBUG] MCP task-manager using generated UUID for project: project (ID: d628296e-a6bd-5712-8cd1-b32bbab5d645)
[DEBUG] Adding external Playwright MCP server (non-Docker mode or disabled)
----------------------------- Captured stderr call -----------------------------
2026-01-08 20:13:29.095 | ERROR    | server.utils.auth:72 | Error reading Claude credentials file: [Errno 2] No such file or directory: '/Users/jeff/.claude/.credentials.json' [taskName=None]
2026-01-08 20:13:29.095 | INFO     | server.utils.auth:97 | [AUTH] Using OAuth token from environment variable (credentials file not available) [taskName=None]
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m server.utils.auth:auth.py:72 Error reading Claude credentials file: [Errno 2] No such file or directory: '/Users/jeff/.claude/.credentials.json'
[32mINFO    [0m server.utils.auth:auth.py:97 [AUTH] Using OAuth token from environment variable (credentials file not available)
[31m[1m_______________ TestClaudeClient.test_create_client_custom_model _______________[0m
[1m[31mtests/test_claude_sdk_client.py[0m:177: in test_create_client_custom_model
    [0moptions = call_args[[94m1[39;49;00m][[33m"[39;49;00m[33moptions[39;49;00m[33m"[39;49;00m][90m[39;49;00m
              ^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: 'NoneType' object is not subscriptable[0m
----------------------------- Captured stdout call -----------------------------
[DEBUG] MCP task-manager using generated UUID for project: project (ID: d628296e-a6bd-5712-8cd1-b32bbab5d645)
[DEBUG] Adding external Playwright MCP server (non-Docker mode or disabled)
----------------------------- Captured stderr call -----------------------------
2026-01-08 20:13:29.097 | ERROR    | server.utils.auth:72 | Error reading Claude credentials file: [Errno 2] No such file or directory: '/Users/jeff/.claude/.credentials.json' [taskName=None]
2026-01-08 20:13:29.097 | INFO     | server.utils.auth:97 | [AUTH] Using OAuth token from environment variable (credentials file not available) [taskName=None]
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m server.utils.auth:auth.py:72 Error reading Claude credentials file: [Errno 2] No such file or directory: '/Users/jeff/.claude/.credentials.json'
[32mINFO    [0m server.utils.auth:auth.py:97 [AUTH] Using OAuth token from environment variable (credentials file not available)
[31m[1m________________ TestClaudeClient.test_create_client_no_api_key ________________[0m
[1m[31mtests/test_claude_sdk_client.py[0m:188: in test_create_client_no_api_key
    [0m[94mwith[39;49;00m pytest.raises([96mValueError[39;49;00m) [94mas[39;49;00m exc_info:[90m[39;49;00m
         ^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   Failed: DID NOT RAISE <class 'ValueError'>[0m
----------------------------- Captured stdout call -----------------------------
[DEBUG] MCP task-manager using generated UUID for project: project (ID: d628296e-a6bd-5712-8cd1-b32bbab5d645)
[DEBUG] Adding external Playwright MCP server (non-Docker mode or disabled)
----------------------------- Captured stderr call -----------------------------
2026-01-08 20:13:29.099 | ERROR    | server.utils.auth:72 | Error reading Claude credentials file: [Errno 2] No such file or directory: '/Users/jeff/.claude/.credentials.json' [taskName=None]
2026-01-08 20:13:29.099 | WARNING  | server.utils.auth:100 | [AUTH] No OAuth token found in credentials file or environment [taskName=None]
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m server.utils.auth:auth.py:72 Error reading Claude credentials file: [Errno 2] No such file or directory: '/Users/jeff/.claude/.credentials.json'
[33mWARNING [0m server.utils.auth:auth.py:100 [AUTH] No OAuth token found in credentials file or environment
[31m[1m__________________ TestSecurityHooks.test_bash_security_hook ___________________[0m
[1m[31mtests/test_claude_sdk_client.py[0m:206: in test_bash_security_hook
    [0mresult = [94mawait[39;49;00m bash_security_hook([33m"[39;49;00m[33mls -la[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mserver/utils/security.py[0m:548: in bash_security_hook
    [0m[94mif[39;49;00m input_data.get([33m"[39;49;00m[33mtool_name[39;49;00m[33m"[39;49;00m) != [33m"[39;49;00m[33mBash[39;49;00m[33m"[39;49;00m:[90m[39;49;00m
       ^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'str' object has no attribute 'get'[0m
[31m[1m_______________ TestDatabaseTransactions.test_transaction_commit _______________[0m
[1m[31mtests/test_database_extended.py[0m:34: in test_transaction_commit
    [0mdb = DatabaseManager(pool=mock_pool)[90m[39;49;00m
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'[0m
[31m[1m_________ TestDatabaseTransactions.test_transaction_rollback_on_error __________[0m
[1m[31mtests/test_database_extended.py[0m:45: in test_transaction_rollback_on_error
    [0mdb = DatabaseManager(pool=mock_pool)[90m[39;49;00m
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'[0m
[31m[1m______________ TestDatabaseTransactions.test_nested_transactions _______________[0m
[1m[31mtests/test_database_extended.py[0m:59: in test_nested_transactions
    [0mdb = DatabaseManager(pool=mock_pool)[90m[39;49;00m
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'[0m
[31m[1m_______________ TestDatabaseConnectionPool.test_connection_reuse _______________[0m
[1m[31mtests/test_database_extended.py[0m:141: in test_connection_reuse
    [0mdb = DatabaseManager(pool=pool)[90m[39;49;00m
         ^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'[0m
[31m[1m______________ TestDatabaseConnectionPool.test_connection_timeout ______________[0m
[1m[31mtests/test_database_extended.py[0m:158: in test_connection_timeout
    [0mdb = DatabaseManager(pool=pool)[90m[39;49;00m
         ^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'[0m
[31m[1m_______________ TestDatabaseMigrations.test_check_schema_version _______________[0m
[1m[31mtests/test_database_extended.py[0m:178: in test_check_schema_version
    [0mdb = DatabaseManager(pool=pool)[90m[39;49;00m
         ^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'[0m
[31m[1m_________________ TestDatabaseMigrations.test_apply_migration __________________[0m
[1m[31mtests/test_database_extended.py[0m:194: in test_apply_migration
    [0mdb = DatabaseManager(pool=pool)[90m[39;49;00m
         ^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'[0m
[31m[1m__________________ TestDatabasePerformance.test_batch_insert ___________________[0m
[1m[31mtests/test_database_extended.py[0m:221: in test_batch_insert
    [0mdb = DatabaseManager(pool=pool)[90m[39;49;00m
         ^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'[0m
[31m[1m_______________ TestDatabasePerformance.test_prepared_statements _______________[0m
[1m[31mtests/test_database_extended.py[0m:244: in test_prepared_statements
    [0mdb = DatabaseManager(pool=pool)[90m[39;49;00m
         ^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'[0m
[31m[1m__________ TestDatabasePerformance.test_connection_pooling_efficiency __________[0m
[1m[31mtests/test_database_extended.py[0m:276: in test_connection_pooling_efficiency
    [0mdb = DatabaseManager(pool=pool)[90m[39;49;00m
         ^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'[0m
[31m[1m______________ TestDatabaseErrorRecovery.test_connection_recovery ______________[0m
[1m[31mtests/test_database_extended.py[0m:305: in test_connection_recovery
    [0mdb = DatabaseManager(pool=pool)[90m[39;49;00m
         ^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'[0m
[31m[1m______________ TestDatabaseErrorRecovery.test_deadlock_detection _______________[0m
[1m[31mtests/test_database_extended.py[0m:330: in test_deadlock_detection
    [0mdb = DatabaseManager(pool=pool)[90m[39;49;00m
         ^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'[0m
[31m[1m__________________ TestDatabaseMonitoring.test_query_logging ___________________[0m
[1m[31mtests/test_database_extended.py[0m:351: in test_query_logging
    [0mdb = DatabaseManager(pool=pool)[90m[39;49;00m
         ^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'[0m
[31m[1m_______________ TestDatabaseMonitoring.test_slow_query_detection _______________[0m
[1m[31mtests/test_database_extended.py[0m:377: in test_slow_query_detection
    [0mdb = DatabaseManager(pool=pool)[90m[39;49;00m
         ^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'[0m
[31m[1m________ TestDatabaseIntegration.test_database_retry_on_transient_error ________[0m
[1m[31mtests/test_integration.py[0m:45: in test_database_retry_on_transient_error
    [0mresult = [94mawait[39;49;00m get_value()[90m[39;49;00m
             ^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mserver/database/retry.py[0m:207: in wrapper
    [0mresult = [94mawait[39;49;00m func(*args, **kwargs)[90m[39;49;00m
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mtests/test_integration.py[0m:43: in get_value
    [0m[94mreturn[39;49;00m [94mawait[39;49;00m mock_conn.fetchval([33m"[39;49;00m[33mSELECT 42[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31m/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py[0m:2328: in _execute_mock_call
    [0m[94mraise[39;49;00m result[90m[39;49;00m
[1m[31mE   server.utils.errors.DatabaseError: Connection lost[0m
----------------------------- Captured stderr call -----------------------------
2026-01-08 20:13:29.412 | ERROR    | server.database.retry:240 | Database operation 'get_value' failed with non-transient error: Connection lost [taskName=Task-314]
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m server.database.retry:retry.py:240 Database operation 'get_value' failed with non-transient error: Connection lost
[31m[1m_______ TestDatabaseIntegration.test_database_gives_up_after_max_retries _______[0m
[1m[31mtests/test_integration.py[0m:66: in test_database_gives_up_after_max_retries
    [0m[94massert[39;49;00m mock_conn.fetchval.call_count == [94m3[39;49;00m[90m[39;49;00m
[1m[31mE   AssertionError: assert 1 == 3[0m
[1m[31mE    +  where 1 = <AsyncMock name='mock.fetchval' id='4464652512'>.call_count[0m
[1m[31mE    +    where <AsyncMock name='mock.fetchval' id='4464652512'> = <AsyncMock id='4464653184'>.fetchval[0m
----------------------------- Captured stderr call -----------------------------
2026-01-08 20:13:29.434 | ERROR    | server.database.retry:240 | Database operation 'get_value' failed with non-transient error: Connection lost [taskName=Task-316]
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m server.database.retry:retry.py:240 Database operation 'get_value' failed with non-transient error: Connection lost
[31m[1m______ TestOrchestratorIntegration.test_orchestrator_with_session_manager ______[0m
[1m[31mtests/test_integration.py[0m:78: in test_orchestrator_with_session_manager
    [0morchestrator = AgentOrchestrator([90m[39;49;00m
[1m[31mE   TypeError: AgentOrchestrator.__init__() got an unexpected keyword argument 'project_id'[0m
[31m[1m_________ TestOrchestratorIntegration.test_orchestrator_handles_errors _________[0m
[1m[31mtests/test_integration.py[0m:103: in test_orchestrator_handles_errors
    [0morchestrator = AgentOrchestrator([90m[39;49;00m
[1m[31mE   TypeError: AgentOrchestrator.__init__() got an unexpected keyword argument 'project_id'[0m
[31m[1m_____ TestSessionManagerIntegration.test_session_manager_with_checkpoints ______[0m
[1m[31mtests/test_integration.py[0m:127: in test_session_manager_with_checkpoints
    [0msession_manager = SessionManager([90m[39;49;00m
[1m[31mE   TypeError: PausedSessionManager.__init__() got an unexpected keyword argument 'session_id'[0m
[31m[1m_____ TestSessionManagerIntegration.test_session_manager_intervention_flow _____[0m
[1m[31mtests/test_integration.py[0m:151: in test_session_manager_intervention_flow
    [0msession_manager = SessionManager([90m[39;49;00m
[1m[31mE   TypeError: PausedSessionManager.__init__() got an unexpected keyword argument 'session_id'[0m
[31m[1m________ TestQualitySystemIntegration.test_quality_metrics_integration _________[0m
[1m[31mtests/test_integration.py[0m:218: in test_quality_metrics_integration
    [0m[94mfrom[39;49;00m[90m [39;49;00m[04m[96mserver[39;49;00m[04m[96m.[39;49;00m[04m[96mquality[39;49;00m[04m[96m.[39;49;00m[04m[96mmetrics[39;49;00m[90m [39;49;00m[94mimport[39;49;00m QualityMetrics[90m[39;49;00m
[1m[31mE   ImportError: cannot import name 'QualityMetrics' from 'server.quality.metrics' (/Users/jeff/code/yokeflow2/server/quality/metrics.py)[0m
[31m[1m_________ TestQualitySystemIntegration.test_quality_gates_integration __________[0m
[1m[31mtests/test_integration.py[0m:246: in test_quality_gates_integration
    [0mgates = QualityGates(db=mock_db)[90m[39;49;00m
            ^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: QualityGates.__init__() missing 2 required positional arguments: 'project_path' and 'config'[0m
[31m[1m__________ TestConfigurationIntegration.test_config_loading_priority ___________[0m
[1m[31mtests/test_integration.py[0m:281: in test_config_loading_priority
    [0mconfig = Config(config_path=config_file)[90m[39;49;00m
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: Config.__init__() got an unexpected keyword argument 'config_path'[0m
[31m[1m_________ TestLoggingIntegration.test_performance_logging_integration __________[0m
[1m[31mtests/test_integration.py[0m:326: in test_performance_logging_integration
    [0m[94massert[39;49;00m perf.duration > [94m0[39;49;00m[90m[39;49;00m
           ^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'PerformanceLogger' object has no attribute 'duration'. Did you mean: 'operation'?[0m
[31m[1m_____________ TestErrorHandlingIntegration.test_error_propagation ______________[0m
[1m[31mtests/test_integration.py[0m:335: in test_error_propagation
    [0m[94mfrom[39;49;00m[90m [39;49;00m[04m[96mserver[39;49;00m[04m[96m.[39;49;00m[04m[96mutils[39;49;00m[04m[96m.[39;49;00m[04m[96merrors[39;49;00m[90m [39;49;00m[94mimport[39;49;00m ([90m[39;49;00m
[1m[31mE   ImportError: cannot import name 'TaskError' from 'server.utils.errors' (/Users/jeff/code/yokeflow2/server/utils/errors.py)[0m
[31m[1m____________ TestErrorHandlingIntegration.test_error_recovery_flow _____________[0m
[1m[31mtests/test_integration.py[0m:354: in test_error_recovery_flow
    [0m[94mfrom[39;49;00m[90m [39;49;00m[04m[96mserver[39;49;00m[04m[96m.[39;49;00m[04m[96magent[39;49;00m[04m[96m.[39;49;00m[04m[96mintervention[39;49;00m[90m [39;49;00m[94mimport[39;49;00m InterventionSystem[90m[39;49;00m
[1m[31mE   ImportError: cannot import name 'InterventionSystem' from 'server.agent.intervention' (/Users/jeff/code/yokeflow2/server/agent/intervention.py)[0m
[31m[1m______________ TestEndToEndIntegration.test_complete_session_flow ______________[0m
[1m[31mtests/test_integration.py[0m:390: in test_complete_session_flow
    [0morchestrator = AgentOrchestrator([90m[39;49;00m
[1m[31mE   TypeError: AgentOrchestrator.__init__() got an unexpected keyword argument 'project_id'[0m
[31m[1m_________________ TestConfigIntegration.test_config_from_file __________________[0m
[1m[31mtests/test_integration_basic.py[0m:81: in test_config_from_file
    [0mconfig = Config(config_path=config_file)[90m[39;49;00m
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: Config.__init__() got an unexpected keyword argument 'config_path'[0m
[31m[1m________________ TestLoggingIntegration.test_performance_logger ________________[0m
[1m[31mtests/test_integration_basic.py[0m:106: in test_performance_logger
    [0m[94massert[39;49;00m perf_logger.duration > [94m0.01[39;49;00m[90m[39;49;00m
           ^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   AttributeError: 'PerformanceLogger' object has no attribute 'duration'. Did you mean: 'operation'?[0m
[31m[1m_________________ TestErrorIntegration.test_error_with_context _________________[0m
[1m[31mtests/test_integration_basic.py[0m:139: in test_error_with_context
    [0m[94mraise[39;49;00m DatabaseError([33m"[39;49;00m[33mConnection failed[39;49;00m[33m"[39;49;00m, details={[90m[39;49;00m
[1m[31mE   TypeError: YokeFlowError.__init__() got an unexpected keyword argument 'details'[0m
[31m[1m___________ TestDatabaseOperations.test_database_connection_pooling ____________[0m
[1m[31mtests/test_integration_basic.py[0m:180: in test_database_connection_pooling
    [0m[94mwith[39;49;00m patch([33m'[39;49;00m[33mserver.database.connection.asyncpg[39;49;00m[33m'[39;49;00m) [94mas[39;49;00m mock_asyncpg:[90m[39;49;00m
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31m/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py[0m:1495: in __enter__
    [0moriginal, local = [96mself[39;49;00m.get_original()[90m[39;49;00m
                      ^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31m/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py[0m:1465: in get_original
    [0m[94mraise[39;49;00m [96mAttributeError[39;49;00m([90m[39;49;00m
[1m[31mE   AttributeError: <module 'server.database.connection' from '/Users/jeff/code/yokeflow2/server/database/connection.py'> does not have the attribute 'asyncpg'[0m
[31m[1m____________ TestCheckpointSystem.test_checkpoint_manager_creation _____________[0m
[1m[31mtests/test_integration_basic.py[0m:219: in test_checkpoint_manager_creation
    [0mmanager = CheckpointManager([90m[39;49;00m
[1m[31mE   TypeError: CheckpointManager.__init__() got an unexpected keyword argument 'db'[0m
[31m[1m____________ TestCheckpointSystem.test_checkpoint_recovery_manager _____________[0m
[1m[31mtests/test_integration_basic.py[0m:235: in test_checkpoint_recovery_manager
    [0mrecovery = CheckpointRecoveryManager(db=mock_db)[90m[39;49;00m
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: CheckpointRecoveryManager.__init__() got an unexpected keyword argument 'db'[0m
[31m[1m________________ TestQualitySystem.test_quality_metrics_import _________________[0m
[1m[31mtests/test_integration_basic.py[0m:245: in test_quality_metrics_import
    [0m[94mfrom[39;49;00m[90m [39;49;00m[04m[96mserver[39;49;00m[04m[96m.[39;49;00m[04m[96mquality[39;49;00m[04m[96m.[39;49;00m[04m[96mmetrics[39;49;00m[90m [39;49;00m[94mimport[39;49;00m QualityMetrics[90m[39;49;00m
[1m[31mE   ImportError: cannot import name 'QualityMetrics' from 'server.quality.metrics' (/Users/jeff/code/yokeflow2/server/quality/metrics.py)[0m
[31m[1m_________________ TestQualitySystem.test_quality_gates_import __________________[0m
[1m[31mtests/test_integration_basic.py[0m:257: in test_quality_gates_import
    [0mgates = QualityGates(db=mock_db)[90m[39;49;00m
            ^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: QualityGates.__init__() missing 2 required positional arguments: 'project_path' and 'config'[0m
[31m[1m_____________ TestAgentOrchestrator.test_start_session_initializer _____________[0m
[1m[31mtests/test_orchestrator.py[0m:285: in test_start_session_initializer
    [0mresult = [94mawait[39;49;00m orchestrator.start_session([90m[39;49;00m
[1m[31mserver/agent/orchestrator.py[0m:690: in start_session
    [0msandbox = SandboxManager.create_sandbox([90m[39;49;00m
[1m[31mserver/sandbox/manager.py[0m:566: in create_sandbox
    [0m[94mraise[39;49;00m [96mValueError[39;49;00m([90m[39;49;00m
[1m[31mE   ValueError: Unknown sandbox type: <MagicMock name='Config.load_default().sandbox.type' id='4464643440'>. Valid options: 'none', 'docker', 'e2b'[0m
----------------------------- Captured stderr call -----------------------------
2026-01-08 20:13:29.598 | WARNING  | server.agent.orchestrator:608 | No sandbox_type in project metadata, using config default: <MagicMock name='Config.load_default().sandbox.type' id='4464643440'> [taskName=Task-409]
2026-01-08 20:13:29.598 | INFO     | server.agent.orchestrator:689 | Creating <MagicMock name='Config.load_default().sandbox.type' id='4464643440'> sandbox for project test_project [taskName=Task-409]
------------------------------ Captured log call -------------------------------
[33mWARNING [0m server.agent.orchestrator:orchestrator.py:608 No sandbox_type in project metadata, using config default: <MagicMock name='Config.load_default().sandbox.type' id='4464643440'>
[32mINFO    [0m server.agent.orchestrator:orchestrator.py:689 Creating <MagicMock name='Config.load_default().sandbox.type' id='4464643440'> sandbox for project test_project
[31m[1m_________ TestAgentOrchestrator.test_start_session_with_active_session _________[0m
[1m[31mtests/test_orchestrator.py[0m:306: in test_start_session_with_active_session
    [0m[94mawait[39;49;00m orchestrator.start_session([90m[39;49;00m
[1m[31mserver/agent/orchestrator.py[0m:591: in start_session
    [0m[33mf[39;49;00m[33m"[39;49;00m[33mis already running (started [39;49;00m[33m{[39;49;00mactive_session[[33m'[39;49;00m[33mstarted_at[39;49;00m[33m'[39;49;00m][33m}[39;49;00m[33m). [39;49;00m[33m"[39;49;00m[90m[39;49;00m
                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   KeyError: 'started_at'[0m
[31m[1m__________ TestAgentOrchestrator.test_start_session_project_not_found __________[0m
[1m[31mtests/test_orchestrator.py[0m:317: in test_start_session_project_not_found
    [0m[94mawait[39;49;00m orchestrator.start_session([90m[39;49;00m
[1m[31mserver/agent/orchestrator.py[0m:583: in start_session
    [0m[94mraise[39;49;00m [96mValueError[39;49;00m([33mf[39;49;00m[33m"[39;49;00m[33mProject not found: [39;49;00m[33m{[39;49;00mproject_id[33m}[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
[1m[31mE   ValueError: Project not found: 366f7a67-4c07-4db6-8ff6-7b9a975e3804[0m
[31m[1m______________ TestAgentOrchestrator.test_get_session_info_active ______________[0m
[1m[31mtests/test_orchestrator.py[0m:382: in test_get_session_info_active
    [0mresult = [94mawait[39;49;00m orchestrator.get_session_info(session_id)[90m[39;49;00m
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mserver/agent/orchestrator.py[0m:1070: in get_session_info
    [0m[94masync[39;49;00m [94mwith[39;49;00m db.acquire() [94mas[39;49;00m conn:[90m[39;49;00m
               ^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: 'coroutine' object does not support the asynchronous context manager protocol[0m
[31m[1m____________ TestAgentOrchestrator.test_get_session_info_not_found _____________[0m
[1m[31mtests/test_orchestrator.py[0m:399: in test_get_session_info_not_found
    [0mresult = [94mawait[39;49;00m orchestrator.get_session_info(session_id)[90m[39;49;00m
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mserver/agent/orchestrator.py[0m:1070: in get_session_info
    [0m[94masync[39;49;00m [94mwith[39;49;00m db.acquire() [94mas[39;49;00m conn:[90m[39;49;00m
               ^^^^^^^^^^^^[90m[39;49;00m
[1m[31mE   TypeError: 'coroutine' object does not support the asynchronous context manager protocol[0m
[31m[1m___________________ TestAgentOrchestrator.test_list_projects ___________________[0m
[1m[31mtests/test_orchestrator.py[0m:420: in test_list_projects
    [0m[94massert[39;49;00m [96mlen[39;49;00m(result) == [94m2[39;49;00m[90m[39;49;00m
[1m[31mE   assert 0 == 2[0m
[1m[31mE    +  where 0 = len([])[0m
[31m[1m_______________ TestQualityIntegration.test_trigger_deep_review ________________[0m
[1m[31m/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/unittest/mock.py[0m:956: in assert_called_once
    [0m[94mraise[39;49;00m [96mAssertionError[39;49;00m(msg)[90m[39;49;00m
[1m[31mE   AssertionError: Expected 'should_trigger_deep_review' to have been called once. Called 0 times.[0m

[33mDuring handling of the above exception, another exception occurred:[0m
[1m[31mtests/test_quality_integration.py[0m:239: in test_trigger_deep_review
    [0mmock_should_trigger.assert_called_once()[90m[39;49;00m
[1m[31mE   AssertionError: Expected 'should_trigger_deep_review' to have been called once. Called 0 times.[0m
----------------------------- Captured stderr call -----------------------------
2026-01-08 20:13:29.662 | ERROR    | server.quality.integration:197 | Failed to trigger deep review: 'coroutine' object does not support the asynchronous context manager protocol [taskName=Task-447]
Traceback (most recent call last):
  File "/Users/jeff/code/yokeflow2/server/quality/integration.py", line 153, in maybe_trigger_deep_review
    async with db.acquire() as conn:
               ~~~~~~~~~~^^
TypeError: 'coroutine' object does not support the asynchronous context manager protocol
------------------------------ Captured log call -------------------------------
[1m[31mERROR   [0m server.quality.integration:integration.py:197 Failed to trigger deep review: 'coroutine' object does not support the asynchronous context manager protocol
Traceback (most recent call last):
  File "/Users/jeff/code/yokeflow2/server/quality/integration.py", line 153, in maybe_trigger_deep_review
    async with db.acquire() as conn:
               ~~~~~~~~~~^^
TypeError: 'coroutine' object does not support the asynchronous context manager protocol
[31m[1m____________ TestQualityGates.test_quality_gate_blocks_low_quality _____________[0m
[1m[31mtests/test_quality_integration.py[0m:304: in test_quality_gate_blocks_low_quality
    [0m[94mfrom[39;49;00m[90m [39;49;00m[04m[96mserver[39;49;00m[04m[96m.[39;49;00m[04m[96mquality[39;49;00m[04m[96m.[39;49;00m[04m[96mgates[39;49;00m[90m [39;49;00m[94mimport[39;49;00m QualityGates, GateType, GateAction[90m[39;49;00m
[1m[31mE   ImportError: cannot import name 'GateAction' from 'server.quality.gates' (/Users/jeff/code/yokeflow2/server/quality/gates.py)[0m
[31m[1m____________ TestQualityGates.test_quality_gate_allows_high_quality ____________[0m
[1m[31mtests/test_quality_integration.py[0m:338: in test_quality_gate_allows_high_quality
    [0m[94mfrom[39;49;00m[90m [39;49;00m[04m[96mserver[39;49;00m[04m[96m.[39;49;00m[04m[96mquality[39;49;00m[04m[96m.[39;49;00m[04m[96mgates[39;49;00m[90m [39;49;00m[94mimport[39;49;00m QualityGates, GateType, GateAction[90m[39;49;00m
[1m[31mE   ImportError: cannot import name 'GateAction' from 'server.quality.gates' (/Users/jeff/code/yokeflow2/server/quality/gates.py)[0m
[31m[1m__________ TestDockerSandboxUnit.test_docker_sandbox_start_with_mock ___________[0m
[1m[31mserver/sandbox/manager.py[0m:266: in start
    [0m[94mawait[39;49;00m [96mself[39;49;00m._cleanup_container()[90m[39;49;00m
[1m[31mserver/sandbox/manager.py[0m:413: in _cleanup_container
    [0mresult = [94mawait[39;49;00m [96mself[39;49;00m.execute_command(cmd, timeout=[94m30[39;49;00m)[90m[39;49;00m
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mserver/sandbox/manager.py[0m:469: in execute_command
    [0m[94mraise[39;49;00m [96mRuntimeError[39;49;00m([33m"[39;49;00m[33mContainer is not healthy[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
[1m[31mE   RuntimeError: Container is not healthy[0m

[33mDuring handling of the above exception, another exception occurred:[0m
[1m[31mtests/test_sandbox_manager.py[0m:119: in test_docker_sandbox_start_with_mock
    [0m[94mawait[39;49;00m docker_sandbox.start()[90m[39;49;00m
[1m[31mserver/sandbox/manager.py[0m:357: in start
    [0m[94mraise[39;49;00m [96mRuntimeError[39;49;00m([33mf[39;49;00m[33m"[39;49;00m[33mFailed to start Docker sandbox: [39;49;00m[33m{[39;49;00me[33m}[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
[1m[31mE   RuntimeError: Failed to start Docker sandbox: Container is not healthy[0m
----------------------------- Captured stderr call -----------------------------
2026-01-08 20:13:29.721 | INFO     | server.sandbox.manager:225 | Using Docker socket: unix:///var/run/docker.sock [taskName=Task-457]
2026-01-08 20:13:29.721 | INFO     | server.sandbox.manager:239 | Found existing container: yokeflow-test_project [taskName=Task-457]
2026-01-08 20:13:29.722 | INFO     | server.sandbox.manager:260 | Coding session: Restarting stopped container [taskName=Task-457]
2026-01-08 20:13:29.722 | INFO     | server.sandbox.manager:395 | Performing enhanced cleanup for reused container... [taskName=Task-457]
2026-01-08 20:13:29.722 | ERROR    | server.sandbox.manager:356 | Failed to start Docker sandbox: Container is not healthy [taskName=Task-457]
------------------------------ Captured log call -------------------------------
[32mINFO    [0m server.sandbox.manager:manager.py:225 Using Docker socket: unix:///var/run/docker.sock
[32mINFO    [0m server.sandbox.manager:manager.py:239 Found existing container: yokeflow-test_project
[32mINFO    [0m server.sandbox.manager:manager.py:260 Coding session: Restarting stopped container
[32mINFO    [0m server.sandbox.manager:manager.py:395 Performing enhanced cleanup for reused container...
[1m[31mERROR   [0m server.sandbox.manager:manager.py:356 Failed to start Docker sandbox: Container is not healthy
[31m[1m_________ TestDockerSandboxUnit.test_docker_sandbox_execute_with_mock __________[0m
[1m[31mtests/test_sandbox_manager.py[0m:143: in test_docker_sandbox_execute_with_mock
    [0mresult = [94mawait[39;49;00m docker_sandbox.execute_command([33m"[39;49;00m[33mecho [39;49;00m[33m'[39;49;00m[33mHello[39;49;00m[33m'[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^[90m[39;49;00m
[1m[31mserver/sandbox/manager.py[0m:465: in execute_command
    [0m[94mraise[39;49;00m [96mRuntimeError[39;49;00m([33m"[39;49;00m[33mDocker sandbox not started[39;49;00m[33m"[39;49;00m)[90m[39;49;00m
[1m[31mE   RuntimeError: Docker sandbox not started[0m
[31m[1m_____ TestDockerSandboxUnit.test_docker_sandbox_is_healthy_with_container ______[0m
[1m[31mtests/test_sandbox_manager.py[0m:205: in test_docker_sandbox_is_healthy_with_container
    [0m[94massert[39;49;00m [94mawait[39;49;00m docker_sandbox.is_healthy() [95mis[39;49;00m [94mTrue[39;49;00m[90m[39;49;00m
[1m[31mE   assert False is True[0m
[33m=============================== warnings summary ===============================[0m
tests/test_agent.py: 17 warnings
tests/test_api_endpoints.py: 30 warnings
tests/test_api_rest.py: 31 warnings
tests/test_checkpoint.py: 9 warnings
tests/test_claude_sdk_client.py: 10 warnings
tests/test_database_operations.py: 3 warnings
tests/test_database_retry.py: 17 warnings
tests/test_epic_validator.py: 14 warnings
tests/test_integration.py: 4 warnings
tests/test_integration_basic.py: 5 warnings
tests/test_orchestrator.py: 2 warnings
tests/test_quality_extended.py: 3 warnings
tests/test_quality_integration.py: 10 warnings
tests/test_sandbox_manager.py: 11 warnings
tests/test_structured_logging.py: 5 warnings
  /Users/jeff/code/yokeflow2/server/utils/logging.py:161: DeprecationWarning: datetime.datetime.utcfromtimestamp() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.fromtimestamp(timestamp, datetime.UTC).
    timestamp = datetime.utcfromtimestamp(record.created).strftime('%Y-%m-%d %H:%M:%S.%f')[:-3]

tests/test_agent.py: 17 warnings
tests/test_api_endpoints.py: 30 warnings
tests/test_api_rest.py: 31 warnings
tests/test_checkpoint.py: 9 warnings
tests/test_claude_sdk_client.py: 10 warnings
tests/test_database_operations.py: 3 warnings
tests/test_database_retry.py: 17 warnings
tests/test_epic_validator.py: 14 warnings
tests/test_integration.py: 4 warnings
tests/test_integration_basic.py: 5 warnings
tests/test_orchestrator.py: 2 warnings
tests/test_quality_extended.py: 3 warnings
tests/test_quality_integration.py: 10 warnings
tests/test_sandbox_manager.py: 11 warnings
tests/test_structured_logging.py: 10 warnings
tests/test_task_verifier.py: 5 warnings
  /Users/jeff/code/yokeflow2/server/utils/logging.py:116: DeprecationWarning: datetime.datetime.utcfromtimestamp() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.fromtimestamp(timestamp, datetime.UTC).
    dt = datetime.utcfromtimestamp(created)

tests/test_api_endpoints.py::TestAuthenticationEndpoints::test_login_success
  /Users/jeff/code/yokeflow2/server/api/auth.py:67: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    expire = datetime.utcnow() + timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)

tests/test_api_endpoints.py::TestAuthenticationEndpoints::test_verify_token
  /Users/jeff/code/yokeflow2/server/api/auth.py:65: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    expire = datetime.utcnow() + expires_delta

tests/test_epic_validator.py::TestEpicValidator::test_validate_epic_all_tasks_pass
tests/test_epic_validator.py::TestEpicValidator::test_validate_epic_some_tasks_fail
tests/test_epic_validator.py::TestEpicValidator::test_validate_epic_needs_rework
tests/test_epic_validator.py::TestEpicValidator::test_error_handling
tests/test_epic_validator.py::TestEpicValidator::test_incremental_validation
  /Users/jeff/code/yokeflow2/server/verification/epic_validator.py:120: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    start_time = datetime.utcnow()

tests/test_epic_validator.py::TestEpicValidator::test_validate_epic_all_tasks_pass
tests/test_epic_validator.py::TestEpicValidator::test_validate_epic_some_tasks_fail
tests/test_epic_validator.py::TestEpicValidator::test_validate_epic_needs_rework
tests/test_epic_validator.py::TestEpicValidator::test_incremental_validation
  /Users/jeff/code/yokeflow2/server/verification/epic_validator.py:188: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    duration = (datetime.utcnow() - start_time).total_seconds()

tests/test_epic_validator.py::TestEpicValidator::test_validate_epic_all_tasks_pass
tests/test_epic_validator.py::TestEpicValidator::test_validate_epic_some_tasks_fail
tests/test_epic_validator.py::TestEpicValidator::test_validate_epic_needs_rework
tests/test_epic_validator.py::TestEpicValidator::test_incremental_validation
  /Users/jeff/code/yokeflow2/server/verification/epic_validator.py:204: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    timestamp=datetime.utcnow()

tests/test_orchestrator.py::TestAgentOrchestrator::test_get_session_info_active
tests/test_orchestrator.py::TestAgentOrchestrator::test_get_session_info_not_found
  /Users/jeff/code/yokeflow2/server/agent/orchestrator.py:1070: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    async with db.acquire() as conn:
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/test_quality_integration.py::TestQualityIntegration::test_run_quality_check_success
tests/test_quality_integration.py::TestQualityIntegration::test_run_quality_check_with_issues
tests/test_quality_integration.py::TestQualityIntegration::test_run_quality_check_initializer_session
tests/test_quality_integration.py::TestQualityIntegration::test_trigger_deep_review
  /Users/jeff/code/yokeflow2/server/quality/integration.py:153: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    async with db.acquire() as conn:
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/test_security.py::test_extract_commands
  /Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but tests/test_security.py::test_extract_commands returned <class 'tuple'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

tests/test_security.py::test_validate_chmod
  /Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/_pytest/python.py:161: PytestReturnNotNoneWarning: Test functions should return None, but tests/test_security.py::test_validate_chmod returned <class 'tuple'>.
  Did you mean to use `assert` instead of `return`?
  See https://docs.pytest.org/en/stable/how-to/assert.html#return-not-none for more information.
    warnings.warn(

tests/test_task_verifier.py::TestTaskVerifier::test_verify_task_success
tests/test_task_verifier.py::TestTaskVerifier::test_verify_task_failure
tests/test_task_verifier.py::TestTaskVerifier::test_verify_task_with_retry
tests/test_task_verifier.py::TestTaskVerifier::test_verify_task_manual_review
tests/test_task_verifier.py::TestTaskVerifier::test_error_handling
tests/test_task_verifier.py::TestTaskVerifier::test_verification_caching
  /Users/jeff/code/yokeflow2/server/verification/task_verifier.py:123: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    start_time = datetime.utcnow()

tests/test_task_verifier.py::TestTaskVerifier::test_verify_task_success
tests/test_task_verifier.py::TestTaskVerifier::test_verify_task_with_retry
tests/test_task_verifier.py::TestTaskVerifier::test_verification_caching
  /Users/jeff/code/yokeflow2/server/verification/task_verifier.py:152: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    duration = (datetime.utcnow() - start_time).total_seconds()

tests/test_task_verifier.py::TestTaskVerifier::test_verify_task_success
tests/test_task_verifier.py::TestTaskVerifier::test_verify_task_with_retry
tests/test_task_verifier.py::TestTaskVerifier::test_verification_caching
  /Users/jeff/code/yokeflow2/server/verification/task_verifier.py:164: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    timestamp=datetime.utcnow()

tests/test_task_verifier.py::TestTaskVerifier::test_verify_task_failure
tests/test_task_verifier.py::TestTaskVerifier::test_verify_task_manual_review
  /Users/jeff/code/yokeflow2/server/verification/task_verifier.py:218: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    duration = (datetime.utcnow() - start_time).total_seconds()

tests/test_task_verifier.py::TestTaskVerifier::test_verify_task_failure
tests/test_task_verifier.py::TestTaskVerifier::test_verify_task_manual_review
  /Users/jeff/code/yokeflow2/server/verification/task_verifier.py:231: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    timestamp=datetime.utcnow()

tests/test_test_generator.py::TestAutoTestGenerator::test_generate_tests_for_task
tests/test_test_generator.py::TestAutoTestGenerator::test_generate_browser_tests
tests/test_test_generator.py::TestAutoTestGenerator::test_generate_api_tests
tests/test_test_generator.py::TestAutoTestGenerator::test_error_handling
  /Users/jeff/code/yokeflow2/server/verification/test_generator.py:147: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    created_at=datetime.utcnow()

tests/test_test_generator.py::TestAutoTestGenerator::test_test_validation
  /Users/jeff/code/yokeflow2/server/verification/test_generator.py:348: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    Generated: {datetime.utcnow().isoformat()}

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
[36m[1m=========================== short test summary info ============================[0m
[31mFAILED[0m tests/test_agent.py::[1mTestRunAgentSession::test_run_agent_session_with_credit_error[0m - Failed: DID NOT RAISE <class 'RuntimeError'>
[31mFAILED[0m tests/test_agent.py::[1mTestRunAgentSession::test_run_agent_session_exception_handling[0m - assert 'Unexpected error' in "cannot access local variable 'usage_data' whe...
[31mFAILED[0m tests/test_api_endpoints.py::[1mTestContainerEndpoints::test_get_container_status[0m - assert 400 == 200
[31mFAILED[0m tests/test_api_endpoints.py::[1mTestContainerEndpoints::test_start_container[0m - assert 400 == 200
[31mFAILED[0m tests/test_api_rest.py::[1mTestHealthEndpoints::test_detailed_health_check[0m - AttributeError: <module 'server.api.app' from '/Users/jeff/code/yokeflow2/s...
[31mFAILED[0m tests/test_api_rest.py::[1mTestSessionEndpoints::test_get_session_logs[0m - AttributeError: Mock object has no attribute 'get_session_logs'. Did you me...
[31mFAILED[0m tests/test_api_rest.py::[1mTestTaskEndpoints::test_list_tasks[0m - assert 500 == 200
[31mFAILED[0m tests/test_api_rest.py::[1mTestEpicEndpoints::test_list_epics[0m - assert 500 == 200
[31mFAILED[0m tests/test_api_rest.py::[1mTestErrorHandling::test_database_error_handling[0m - assert 400 == 500
[31mFAILED[0m tests/test_claude_client.py::[1mTestClaudeClient::test_create_client_basic[0m - FileNotFoundError: MCP task manager server not found at /Users/jeff/code/mc...
[31mFAILED[0m tests/test_claude_client.py::[1mTestClaudeClient::test_create_client_with_docker[0m - FileNotFoundError: MCP task manager server not found at /Users/jeff/code/mc...
[31mFAILED[0m tests/test_claude_client.py::[1mTestClaudeClient::test_create_client_without_docker_playwright[0m - FileNotFoundError: MCP task manager server not found at /Users/jeff/code/mc...
[31mFAILED[0m tests/test_claude_client.py::[1mTestClaudeClient::test_create_client_removes_api_key[0m - FileNotFoundError: MCP task manager server not found at /Users/jeff/code/mc...
[31mFAILED[0m tests/test_claude_client.py::[1mTestClaudeClient::test_create_client_hooks_configured[0m - FileNotFoundError: MCP task manager server not found at /Users/jeff/code/mc...
[31mFAILED[0m tests/test_claude_client.py::[1mTestClaudeClient::test_create_client_oauth_token_in_env[0m - FileNotFoundError: MCP task manager server not found at /Users/jeff/code/mc...
[31mFAILED[0m tests/test_claude_client.py::[1mTestClaudeClient::test_create_client_system_prompt[0m - FileNotFoundError: MCP task manager server not found at /Users/jeff/code/mc...
[31mFAILED[0m tests/test_claude_sdk_client.py::[1mTestClaudeClient::test_create_client_basic[0m - AssertionError: Expected 'ClaudeSDKClient' to have been called once. Called...
[31mFAILED[0m tests/test_claude_sdk_client.py::[1mTestClaudeClient::test_create_client_with_docker[0m - AssertionError: Expected 'ClaudeSDKClient' to have been called once. Called...
[31mFAILED[0m tests/test_claude_sdk_client.py::[1mTestClaudeClient::test_create_client_with_hooks[0m - TypeError: 'NoneType' object is not subscriptable
[31mFAILED[0m tests/test_claude_sdk_client.py::[1mTestClaudeClient::test_create_client_custom_model[0m - TypeError: 'NoneType' object is not subscriptable
[31mFAILED[0m tests/test_claude_sdk_client.py::[1mTestClaudeClient::test_create_client_no_api_key[0m - Failed: DID NOT RAISE <class 'ValueError'>
[31mFAILED[0m tests/test_claude_sdk_client.py::[1mTestSecurityHooks::test_bash_security_hook[0m - AttributeError: 'str' object has no attribute 'get'
[31mFAILED[0m tests/test_database_extended.py::[1mTestDatabaseTransactions::test_transaction_commit[0m - TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'
[31mFAILED[0m tests/test_database_extended.py::[1mTestDatabaseTransactions::test_transaction_rollback_on_error[0m - TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'
[31mFAILED[0m tests/test_database_extended.py::[1mTestDatabaseTransactions::test_nested_transactions[0m - TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'
[31mFAILED[0m tests/test_database_extended.py::[1mTestDatabaseConnectionPool::test_connection_reuse[0m - TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'
[31mFAILED[0m tests/test_database_extended.py::[1mTestDatabaseConnectionPool::test_connection_timeout[0m - TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'
[31mFAILED[0m tests/test_database_extended.py::[1mTestDatabaseMigrations::test_check_schema_version[0m - TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'
[31mFAILED[0m tests/test_database_extended.py::[1mTestDatabaseMigrations::test_apply_migration[0m - TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'
[31mFAILED[0m tests/test_database_extended.py::[1mTestDatabasePerformance::test_batch_insert[0m - TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'
[31mFAILED[0m tests/test_database_extended.py::[1mTestDatabasePerformance::test_prepared_statements[0m - TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'
[31mFAILED[0m tests/test_database_extended.py::[1mTestDatabasePerformance::test_connection_pooling_efficiency[0m - TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'
[31mFAILED[0m tests/test_database_extended.py::[1mTestDatabaseErrorRecovery::test_connection_recovery[0m - TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'
[31mFAILED[0m tests/test_database_extended.py::[1mTestDatabaseErrorRecovery::test_deadlock_detection[0m - TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'
[31mFAILED[0m tests/test_database_extended.py::[1mTestDatabaseMonitoring::test_query_logging[0m - TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'
[31mFAILED[0m tests/test_database_extended.py::[1mTestDatabaseMonitoring::test_slow_query_detection[0m - TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'
[31mFAILED[0m tests/test_integration.py::[1mTestDatabaseIntegration::test_database_retry_on_transient_error[0m - server.utils.errors.DatabaseError: Connection lost
[31mFAILED[0m tests/test_integration.py::[1mTestDatabaseIntegration::test_database_gives_up_after_max_retries[0m - AssertionError: assert 1 == 3
[31mFAILED[0m tests/test_integration.py::[1mTestOrchestratorIntegration::test_orchestrator_with_session_manager[0m - TypeError: AgentOrchestrator.__init__() got an unexpected keyword argument ...
[31mFAILED[0m tests/test_integration.py::[1mTestOrchestratorIntegration::test_orchestrator_handles_errors[0m - TypeError: AgentOrchestrator.__init__() got an unexpected keyword argument ...
[31mFAILED[0m tests/test_integration.py::[1mTestSessionManagerIntegration::test_session_manager_with_checkpoints[0m - TypeError: PausedSessionManager.__init__() got an unexpected keyword argume...
[31mFAILED[0m tests/test_integration.py::[1mTestSessionManagerIntegration::test_session_manager_intervention_flow[0m - TypeError: PausedSessionManager.__init__() got an unexpected keyword argume...
[31mFAILED[0m tests/test_integration.py::[1mTestQualitySystemIntegration::test_quality_metrics_integration[0m - ImportError: cannot import name 'QualityMetrics' from 'server.quality.metri...
[31mFAILED[0m tests/test_integration.py::[1mTestQualitySystemIntegration::test_quality_gates_integration[0m - TypeError: QualityGates.__init__() missing 2 required positional arguments:...
[31mFAILED[0m tests/test_integration.py::[1mTestConfigurationIntegration::test_config_loading_priority[0m - TypeError: Config.__init__() got an unexpected keyword argument 'config_path'
[31mFAILED[0m tests/test_integration.py::[1mTestLoggingIntegration::test_performance_logging_integration[0m - AttributeError: 'PerformanceLogger' object has no attribute 'duration'. Did...
[31mFAILED[0m tests/test_integration.py::[1mTestErrorHandlingIntegration::test_error_propagation[0m - ImportError: cannot import name 'TaskError' from 'server.utils.errors' (/Us...
[31mFAILED[0m tests/test_integration.py::[1mTestErrorHandlingIntegration::test_error_recovery_flow[0m - ImportError: cannot import name 'InterventionSystem' from 'server.agent.int...
[31mFAILED[0m tests/test_integration.py::[1mTestEndToEndIntegration::test_complete_session_flow[0m - TypeError: AgentOrchestrator.__init__() got an unexpected keyword argument ...
[31mFAILED[0m tests/test_integration_basic.py::[1mTestConfigIntegration::test_config_from_file[0m - TypeError: Config.__init__() got an unexpected keyword argument 'config_path'
[31mFAILED[0m tests/test_integration_basic.py::[1mTestLoggingIntegration::test_performance_logger[0m - AttributeError: 'PerformanceLogger' object has no attribute 'duration'. Did...
[31mFAILED[0m tests/test_integration_basic.py::[1mTestErrorIntegration::test_error_with_context[0m - TypeError: YokeFlowError.__init__() got an unexpected keyword argument 'det...
[31mFAILED[0m tests/test_integration_basic.py::[1mTestDatabaseOperations::test_database_connection_pooling[0m - AttributeError: <module 'server.database.connection' from '/Users/jeff/code...
[31mFAILED[0m tests/test_integration_basic.py::[1mTestCheckpointSystem::test_checkpoint_manager_creation[0m - TypeError: CheckpointManager.__init__() got an unexpected keyword argument ...
[31mFAILED[0m tests/test_integration_basic.py::[1mTestCheckpointSystem::test_checkpoint_recovery_manager[0m - TypeError: CheckpointRecoveryManager.__init__() got an unexpected keyword a...
[31mFAILED[0m tests/test_integration_basic.py::[1mTestQualitySystem::test_quality_metrics_import[0m - ImportError: cannot import name 'QualityMetrics' from 'server.quality.metri...
[31mFAILED[0m tests/test_integration_basic.py::[1mTestQualitySystem::test_quality_gates_import[0m - TypeError: QualityGates.__init__() missing 2 required positional arguments:...
[31mFAILED[0m tests/test_orchestrator.py::[1mTestAgentOrchestrator::test_start_session_initializer[0m - ValueError: Unknown sandbox type: <MagicMock name='Config.load_default().sa...
[31mFAILED[0m tests/test_orchestrator.py::[1mTestAgentOrchestrator::test_start_session_with_active_session[0m - KeyError: 'started_at'
[31mFAILED[0m tests/test_orchestrator.py::[1mTestAgentOrchestrator::test_start_session_project_not_found[0m - ValueError: Project not found: 366f7a67-4c07-4db6-8ff6-7b9a975e3804
[31mFAILED[0m tests/test_orchestrator.py::[1mTestAgentOrchestrator::test_get_session_info_active[0m - TypeError: 'coroutine' object does not support the asynchronous context man...
[31mFAILED[0m tests/test_orchestrator.py::[1mTestAgentOrchestrator::test_get_session_info_not_found[0m - TypeError: 'coroutine' object does not support the asynchronous context man...
[31mFAILED[0m tests/test_orchestrator.py::[1mTestAgentOrchestrator::test_list_projects[0m - assert 0 == 2
[31mFAILED[0m tests/test_quality_integration.py::[1mTestQualityIntegration::test_trigger_deep_review[0m - AssertionError: Expected 'should_trigger_deep_review' to have been called o...
[31mFAILED[0m tests/test_quality_integration.py::[1mTestQualityGates::test_quality_gate_blocks_low_quality[0m - ImportError: cannot import name 'GateAction' from 'server.quality.gates' (/...
[31mFAILED[0m tests/test_quality_integration.py::[1mTestQualityGates::test_quality_gate_allows_high_quality[0m - ImportError: cannot import name 'GateAction' from 'server.quality.gates' (/...
[31mFAILED[0m tests/test_sandbox_manager.py::[1mTestDockerSandboxUnit::test_docker_sandbox_start_with_mock[0m - RuntimeError: Failed to start Docker sandbox: Container is not healthy
[31mFAILED[0m tests/test_sandbox_manager.py::[1mTestDockerSandboxUnit::test_docker_sandbox_execute_with_mock[0m - RuntimeError: Docker sandbox not started
[31mFAILED[0m tests/test_sandbox_manager.py::[1mTestDockerSandboxUnit::test_docker_sandbox_is_healthy_with_container[0m - assert False is True
[31mERROR[0m tests/test_database_extended.py::[1mTestDatabaseQueryBuilder::test_parameterized_query[0m - TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'
[31mERROR[0m tests/test_database_extended.py::[1mTestDatabaseQueryBuilder::test_sql_injection_prevention[0m - TypeError: TaskDatabase.__init__() got an unexpected keyword argument 'pool'
[31mERROR[0m tests/test_integration_database.py::[1mTestDatabaseIntegration::test_database_connection[0m
[31mERROR[0m tests/test_integration_database.py::[1mTestDatabaseIntegration::test_project_creation[0m
[31mERROR[0m tests/test_integration_database.py::[1mTestDatabaseIntegration::test_task_database_operations[0m
[31mERROR[0m tests/test_integration_database.py::[1mTestDatabaseIntegration::test_update_task_status[0m
[31mERROR[0m tests/test_integration_database.py::[1mTestDatabaseIntegration::test_database_manager[0m
[31mERROR[0m tests/test_integration_database.py::[1mTestDatabaseIntegration::test_transaction_rollback[0m
[31mERROR[0m tests/test_integration_database.py::[1mTestDatabaseIntegration::test_cascading_delete[0m
[31mERROR[0m tests/test_integration_database.py::[1mTestDatabaseViews::test_progress_view[0m
[31m= [31m[1m69 failed[0m, [32m329 passed[0m, [33m19 skipped[0m, [33m6 deselected[0m, [33m396 warnings[0m, [31m[1m10 errors[0m[31m in 2.69s[0m[31m =[0m
