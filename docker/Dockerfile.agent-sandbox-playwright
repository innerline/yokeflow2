# Dockerfile for YokeFlow Agent Sandbox with Playwright Support
# Based on Playwright's official image with Ubuntu 24.04 (Noble)

FROM mcr.microsoft.com/playwright:v1.49.0-noble

# The Playwright v1.49.0-noble image already includes Node.js 20 LTS
# Verify and update Node.js if needed
RUN node --version && npm --version

# Install additional development dependencies
RUN apt-get update && apt-get install -y \
    git \
    curl \
    build-essential \
    python3 \
    python3-pip \
    procps \
    lsof \
    jq \
    sqlite3 \
    && rm -rf /var/lib/apt/lists/*

# Install global npm packages
RUN npm install -g pnpm@latest npm@latest

# Install agent-browser for AI-optimized browser automation
# This provides a simpler CLI interface compared to Playwright scripts
RUN npm install -g agent-browser && \
    agent-browser install --with-deps

# Pre-install Playwright browsers (already included in base image)
# This ensures chromium, firefox, and webkit are available for fallback

# Create workspace directory
WORKDIR /workspace

# Create a non-root user for better security (optional)
# RUN useradd -m -s /bin/bash agent && chown -R agent:agent /workspace
# USER agent

# Environment variables
ENV NODE_ENV=development
ENV PLAYWRIGHT_BROWSERS_PATH=/ms-playwright

# Keep container running
CMD ["sleep", "infinity"]