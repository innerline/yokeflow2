# YokeFlow Configuration
# ======================
#
# This is an example configuration file showing all available options.
# Copy this file to one of these locations to use it:
#   - .yokeflow.yaml (current directory, project-specific)
#   - ~/.yokeflow.yaml (home directory, global defaults)
#
# You can also specify a custom config file with: --config path/to/config.yaml
#
# All settings are optional - any omitted values will use built-in defaults.
# Command-line arguments always override config file settings.

# Model Configuration
# -------------------
# Specify which Claude models to use for different session types
models:
  # Model for initialization session (creates project structure and task database)
  # Opus is recommended for better planning capabilities
  initializer: claude-opus-4-5-20251101

  # Model for coding sessions (implements features)
  # Sonnet is recommended for faster, more cost-effective implementation
  coding: claude-sonnet-4-5-20250929

  # Model for quality reviews (deep code analysis)
  # Sonnet provides good analysis at lower cost
  review: claude-sonnet-4-5-20250929

  # Model for prompt improvement analysis (Phase 4 quality system)
  # Opus is recommended for better reasoning and comprehensive improvements
  # This is a critical task that benefits from the most capable model
  prompt_improvement: claude-opus-4-5-20251101

# Timing Configuration
# --------------------
# Control delays and intervals
timing:
  # Seconds to wait between autonomous sessions
  auto_continue_delay: 3

  # Seconds for web UI auto-refresh polling interval
  web_ui_poll_interval: 5

  # Port for web UI dashboard (Next.js default)
  web_ui_port: 3000

# Security Configuration
# ----------------------
# Add custom commands to the blocklist
security:
  # List of additional commands to block (beyond built-in blocklist)
  # Examples: custom deployment scripts, dangerous utilities
  additional_blocked_commands:
    # - my-dangerous-script
    # - custom-deploy

# Project Configuration
# ---------------------
# Project and directory settings
project:
  # Default directory for generated projects
  default_generations_dir: generations

  # Default maximum iterations (null = unlimited)
  # Set a number to limit iterations by default
  max_iterations: null

# Review Configuration
# --------------------
# Settings for the quality review and prompt improvement system
review:
  # Minimum deep reviews required before running prompt improvement analysis
  # Lower values (3-5) provide faster insights but less statistical significance
  # Higher values (10-15) provide more robust patterns but require more sessions
  min_reviews_for_analysis: 3  # Default: 3

# Epic Testing Configuration (Phase 3 - February 2026)
# -----------------------------------------------------
# Control how epic tests are handled when they fail
epic_testing:
  # Testing mode: "strict" or "autonomous"
  # - strict: Block immediately on any epic test failure, require human intervention
  # - autonomous: Continue on minor failures, block only on critical epics or >3 failures
  mode: autonomous  # Default: autonomous (recommended for most projects)

  # Critical epic patterns (will block immediately in autonomous mode)
  # Epic names containing these substrings are considered critical
  critical_epics:
    - Authentication
    - Database
    - Payment
    - Security
    - Core API

  # Autonomous mode: Maximum failures before blocking (non-critical epics)
  auto_failure_tolerance: 3

  # Autonomous mode: Auto-create fix tasks for failures
  auto_create_fix_tasks: true

  # Strict mode: Send notification when blocked
  strict_notify_on_block: true

# Epic Re-testing Configuration (Phase 5 - February 2026)
# ---------------------------------------------------------
# Periodically re-test completed epics to catch regressions
epic_retesting:
  # Enable/disable epic re-testing system
  enabled: true

  # Trigger frequency: Re-test after every N completed epics
  # Example: 2 means after epic 3, 5, 7, 9, etc.
  trigger_frequency: 2

  # Foundation re-test interval: Re-test foundation epics if older than N days
  # Foundation epics (database, auth, core API) are tested more frequently
  foundation_retest_days: 7

  # Maximum epics to re-test per trigger
  # Limits testing overhead while maintaining good coverage
  max_retests_per_trigger: 2

  # Prioritize foundation epics (database, auth, core API)
  # Foundation epics are tested more frequently than features
  prioritize_foundation: true

  # Prioritize epics with many dependents
  # Epics that other epics depend on are tested more frequently
  prioritize_dependents: true

  # Auto-pause session on critical regression (optional)
  # If a previously passing epic test fails, pause for intervention
  pause_on_regression: false

  # Create rework tasks for failed re-tests
  # Automatically creates tasks to fix regressions
  auto_create_rework_tasks: true

# Testing Configuration (Phase 2 - January 2026)
# ------------------------------------------------
# Tests are created during initialization with executable test_code
# and run by the coding agent using run_task_tests before marking tasks complete
#
# Currently these settings are placeholders for future configuration:
# - Test timeout settings
# - Test execution parallelization
# - Test output verbosity
#
# The test execution system is active but configuration is not yet exposed.

# Future Configuration Options (Not Yet Implemented)
# ---------------------------------------------------
# The following systems were partially implemented but are currently disabled:
#
# 1. Intervention System - Would detect infinite loops and blockers
#    Status: Database tables exist, but system is disabled
#
# 2. Verification System - Would auto-generate tests
#    Status: Replaced by Phase 2 test execution (tests created during init)
#
# 3. Epic Validation - Would run integration tests across tasks
#    Status: Database support exists, but not yet integrated
#
# These features may be re-enabled in future versions as needed.

# Sandbox Configuration
# ----------------------
# Isolated execution environments for agent sessions
sandbox:
  # Sandbox type: "none" (no isolation), "docker" (local containers), or "e2b" (cloud)
  # none: Current behavior - runs directly on host (faster but can leak environment variables)
  # docker: Runs in Docker container (good isolation, zero cost, unlimited duration)
  # e2b: Runs in E2B cloud sandbox (production-ready, requires paid tier for long sessions)
  type: none

  # Docker-specific settings (when type: docker)
  docker_image: yokeflow-playwright:latest  # Or node:20-slim for basic setup
  docker_network: bridge
  docker_memory_limit: 3g  # Increased for browser operations if using Playwright
  docker_cpu_limit: "2.0"
  # Port forwarding (optional - not needed if Playwright runs inside container)
  # docker_ports:
  #   - "5173:5173"  # Only if you need manual browser access for debugging

  # E2B-specific settings (when type: e2b)
  # e2b_api_key: ${E2B_API_KEY}  # Or set E2B_API_KEY environment variable
  # e2b_tier: pro  # "free" (1-hour limit) or "pro" (24-hour limit, $150/month)

docker:
  enabled: true
  image: yokeflow-playwright:latest

# ============================================================================
# Usage:
# ============================================================================
#
# This configuration file is automatically detected and loaded by:
# - Web UI (http://localhost:3000) - Primary interface for all operations
# - API Server (http://localhost:8000) - REST API + WebSocket
# - Utility scripts in scripts/ directory
#
# Configuration Priority (highest to lowest):
# 1. Web UI settings (model selection, project-specific config)
# 2. Configuration file (.yokeflow.yaml in project dir or ~/.yokeflow.yaml)
# 3. Environment variables (.env file)
# 4. Built-in defaults
#
# ============================================================================
# Getting Started:
# ============================================================================
#
# 1. Copy this file to .yokeflow.yaml (project) or ~/.yokeflow.yaml (global)
# 2. Start the API server: python api/start_api.py
# 3. Start the Web UI: cd web-ui && npm run dev
# 4. Open http://localhost:3000 to create and manage projects
#
# For utility scripts, see scripts/README.md
# ============================================================================
